<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hunter1023.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":3,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="生成数据 数据可视化：通过可视化表示来探索数据 数据挖掘：使用代码来探索数据集的规律和关联  安装 matplotlibpippip是一个以Python写成的软件包管理系统，它可以安装和管理软件包。 大多数较新的Python版本都自带pip，因此首先可检查系统是否已经安装了pip。  在Windows系统中检查是否安装了pip   打开一个终端窗口，并执行如下命令：   &gt; python -">
<meta property="og:type" content="article">
<meta property="og:title" content="Python项目——数据可视化">
<meta property="og:url" content="https://hunter1023.github.io/2020/06/28/Python%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/index.html">
<meta property="og:site_name" content="Talk is cheap">
<meta property="og:description" content="生成数据 数据可视化：通过可视化表示来探索数据 数据挖掘：使用代码来探索数据集的规律和关联  安装 matplotlibpippip是一个以Python写成的软件包管理系统，它可以安装和管理软件包。 大多数较新的Python版本都自带pip，因此首先可检查系统是否已经安装了pip。  在Windows系统中检查是否安装了pip   打开一个终端窗口，并执行如下命令：   &gt; python -">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/08/23/sQpFl2vnWYNZ4x7.png">
<meta property="article:published_time" content="2020-06-28T03:45:57.000Z">
<meta property="article:modified_time" content="2025-01-23T15:29:13.000Z">
<meta property="article:author" content="Hunter">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="matplotlib">
<meta property="article:tag" content="svg">
<meta property="article:tag" content="CSV">
<meta property="article:tag" content="pyplot">
<meta property="article:tag" content="pygal">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/08/23/sQpFl2vnWYNZ4x7.png">


<link rel="canonical" href="https://hunter1023.github.io/2020/06/28/Python%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hunter1023.github.io/2020/06/28/Python%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/","path":"2020/06/28/Python项目——数据可视化/","title":"Python项目——数据可视化"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Python项目——数据可视化 | Talk is cheap</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Talk is cheap</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE"><span class="nav-number">1.</span> <span class="nav-text">生成数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-matplotlib"><span class="nav-number">1.1.</span> <span class="nav-text">安装 matplotlib</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pip"><span class="nav-number">1.1.1.</span> <span class="nav-text">pip</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8-Windows-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-matplotlib"><span class="nav-number">1.1.2.</span> <span class="nav-text">在 Windows 系统中安装 matplotlib</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-matplotlib"><span class="nav-number">1.1.3.</span> <span class="nav-text">测试 matplotlib</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E7%AE%80%E5%8D%95%E7%9A%84%E6%8A%98%E7%BA%BF%E5%9B%BE"><span class="nav-number">1.2.</span> <span class="nav-text">绘制简单的折线图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E7%AD%BE%E6%96%87%E5%AD%97%E5%92%8C%E7%BA%BF%E6%9D%A1%E7%B2%97%E7%BB%86"><span class="nav-number">1.2.1.</span> <span class="nav-text">修改标签文字和线条粗细</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%A1%E6%AD%A3%E5%9B%BE%E5%BD%A2"><span class="nav-number">1.2.2.</span> <span class="nav-text">校正图形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-scatter-%E7%BB%98%E5%88%B6%E6%95%A3%E7%82%B9%E5%9B%BE%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%85%B6%E6%A0%B7%E5%BC%8F"><span class="nav-number">1.2.3.</span> <span class="nav-text">使用 scatter() 绘制散点图并设置其样式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-scatter-%E7%BB%98%E5%88%B6%E4%B8%80%E7%B3%BB%E5%88%97%E7%82%B9"><span class="nav-number">1.2.4.</span> <span class="nav-text">使用 scatter() 绘制一系列点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%AE%A1%E7%AE%97%E6%95%B0%E6%8D%AE"><span class="nav-number">1.2.5.</span> <span class="nav-text">自动计算数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E7%82%B9%E7%9A%84%E8%BD%AE%E5%BB%93"><span class="nav-number">1.2.6.</span> <span class="nav-text">删除数据点的轮廓</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A2%9C%E8%89%B2"><span class="nav-number">1.2.7.</span> <span class="nav-text">自定义颜色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%A2%9C%E8%89%B2%E6%98%A0%E5%B0%84"><span class="nav-number">1.2.8.</span> <span class="nav-text">使用颜色映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E4%BF%9D%E5%AD%98%E5%9B%BE%E8%A1%A8"><span class="nav-number">1.2.9.</span> <span class="nav-text">自动保存图表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E9%A5%BC%E5%9B%BE"><span class="nav-number">1.3.</span> <span class="nav-text">绘制饼图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%BC%AB%E6%AD%A5"><span class="nav-number">1.4.</span> <span class="nav-text">随机漫步</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-RandomWalk-%E7%B1%BB"><span class="nav-number">1.4.1.</span> <span class="nav-text">创建 RandomWalk() 类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E6%96%B9%E5%90%91"><span class="nav-number">1.4.2.</span> <span class="nav-text">选择方向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E9%9A%8F%E6%9C%BA%E6%BC%AB%E6%AD%A5%E5%9B%BE"><span class="nav-number">1.4.3.</span> <span class="nav-text">绘制随机漫步图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E5%A4%9A%E6%AC%A1%E9%9A%8F%E6%9C%BA%E6%BC%AB%E6%AD%A5"><span class="nav-number">1.4.4.</span> <span class="nav-text">模拟多次随机漫步</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%99%E7%82%B9%E7%9D%80%E8%89%B2"><span class="nav-number">1.4.5.</span> <span class="nav-text">给点着色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E7%BB%98%E5%88%B6%E8%B5%B7%E7%82%B9%E5%92%8C%E7%BB%88%E7%82%B9"><span class="nav-number">1.4.6.</span> <span class="nav-text">重新绘制起点和终点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%90%E8%97%8F%E5%9D%90%E6%A0%87%E8%BD%B4"><span class="nav-number">1.4.7.</span> <span class="nav-text">隐藏坐标轴</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0%E7%82%B9%E6%95%B0"><span class="nav-number">1.4.8.</span> <span class="nav-text">增加点数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E5%B0%BA%E5%AF%B8%E4%BB%A5%E9%80%82%E5%90%88%E5%B1%8F%E5%B9%95"><span class="nav-number">1.4.9.</span> <span class="nav-text">调整尺寸以适合屏幕</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Pygal-%E6%A8%A1%E6%8B%9F%E6%8E%B7%E9%AA%B0%E5%AD%90"><span class="nav-number">1.5.</span> <span class="nav-text">使用 Pygal 模拟掷骰子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Pygal"><span class="nav-number">1.5.1.</span> <span class="nav-text">安装 Pygal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Paygal-%E7%94%BB%E5%BB%8A"><span class="nav-number">1.5.2.</span> <span class="nav-text">Paygal 画廊</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Die-%E7%B1%BB"><span class="nav-number">1.5.3.</span> <span class="nav-text">创建 Die 类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%B7%E9%AA%B0%E5%AD%90"><span class="nav-number">1.5.4.</span> <span class="nav-text">掷骰子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C"><span class="nav-number">1.5.5.</span> <span class="nav-text">分析结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%9D%A1%E5%BD%A2%E5%9B%BE-bar-chart"><span class="nav-number">1.5.6.</span> <span class="nav-text">绘制条形图(bar chart)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E7%9B%B4%E6%96%B9%E5%9B%BE-histogram"><span class="nav-number">1.5.7.</span> <span class="nav-text">绘制直方图(histogram)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%97%B6%E6%8E%B7%E4%B8%A4%E4%B8%AA%E9%AA%B0%E5%AD%90"><span class="nav-number">1.5.8.</span> <span class="nav-text">同时掷两个骰子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%97%B6%E6%8E%B7%E4%B8%A4%E4%B8%AA%E9%9D%A2%E6%95%B0%E4%B8%8D%E5%90%8C%E7%9A%84%E9%AA%B0%E5%AD%90"><span class="nav-number">1.5.9.</span> <span class="nav-text">同时掷两个面数不同的骰子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="nav-number">2.</span> <span class="nav-text">下载数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CSV-%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">CSV 文件格式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-CSV-%E6%96%87%E4%BB%B6%E5%A4%B4"><span class="nav-number">2.1.1.</span> <span class="nav-text">分析 CSV 文件头</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E6%96%87%E4%BB%B6%E5%A4%B4%E5%8F%8A%E5%85%B6%E4%BD%8D%E7%BD%AE"><span class="nav-number">2.1.2.</span> <span class="nav-text">打印文件头及其位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E5%B9%B6%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.3.</span> <span class="nav-text">提取并读取数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%B0%94%E6%B8%A9%E5%9B%BE%E8%A1%A8"><span class="nav-number">2.1.4.</span> <span class="nav-text">绘制气温图表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97-datetime"><span class="nav-number">2.1.5.</span> <span class="nav-text">模块 datetime</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%9B%BE%E8%A1%A8%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%97%A5%E6%9C%9F"><span class="nav-number">2.1.6.</span> <span class="nav-text">在图表中添加日期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B6%B5%E7%9B%96%E6%9B%B4%E9%95%BF%E7%9A%84%E6%97%B6%E9%97%B4"><span class="nav-number">2.1.7.</span> <span class="nav-text">涵盖更长的时间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%8D%E7%BB%98%E5%88%B6%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E7%B3%BB%E5%88%97"><span class="nav-number">2.1.8.</span> <span class="nav-text">再绘制一个数据系列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%99%E5%9B%BE%E8%A1%A8%E5%8C%BA%E5%9F%9F%E7%9D%80%E8%89%B2"><span class="nav-number">2.1.9.</span> <span class="nav-text">给图表区域着色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%A3%80%E6%9F%A5"><span class="nav-number">2.1.10.</span> <span class="nav-text">错误检查</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-2-%E6%AF%94%E8%BE%83%E9%94%A1%E7%89%B9%E5%8D%A1%E5%92%8C%E6%AD%BB%E4%BA%A1%E8%B0%B7%E7%9A%84%E6%B0%94%E6%B8%A9%EF%BC%9A"><span class="nav-number">2.2.</span> <span class="nav-text">16-2  比较锡特卡和死亡谷的气温：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E4%BA%A4%E6%98%93%E6%94%B6%E7%9B%98%E4%BB%B7%E8%B5%B0%E5%8A%BF%E5%9B%BE%EF%BC%9A-JSON-%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.3.</span> <span class="nav-text">制作交易收盘价走势图： JSON 格式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%94%B6%E7%9B%98%E4%BB%B7%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.1.</span> <span class="nav-text">下载收盘价数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.2.</span> <span class="nav-text">提取相关的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%95%B0%E5%AD%97%E5%80%BC"><span class="nav-number">2.3.3.</span> <span class="nav-text">将字符串转换为数字值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%94%B6%E7%9B%98%E4%BB%B7%E6%8A%98%E7%BA%BF%E5%9B%BE"><span class="nav-number">2.3.4.</span> <span class="nav-text">绘制收盘价折线图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%89%B9%E5%BE%81%E5%88%9D%E6%8E%A2"><span class="nav-number">2.3.5.</span> <span class="nav-text">时间序列特征初探</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%B6%E7%9B%98%E4%BB%B7%E5%9D%87%E5%80%BC"><span class="nav-number">2.3.6.</span> <span class="nav-text">收盘价均值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%B6%E7%9B%98%E4%BB%B7%E6%95%B0%E6%8D%AE%E4%BB%AA%E8%A1%A8%E7%9B%98"><span class="nav-number">2.3.7.</span> <span class="nav-text">收盘价数据仪表盘</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-API"><span class="nav-number">3.</span> <span class="nav-text">使用 API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Web-API"><span class="nav-number">3.1.</span> <span class="nav-text">使用 Web API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Git-%E5%92%8C-GitHub"><span class="nav-number">3.1.1.</span> <span class="nav-text">Git 和 GitHub</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-API-%E8%B0%83%E7%94%A8%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE"><span class="nav-number">3.1.2.</span> <span class="nav-text">使用 API 调用请求数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-requests"><span class="nav-number">3.1.3.</span> <span class="nav-text">安装 requests</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86-API-%E5%93%8D%E5%BA%94"><span class="nav-number">3.1.4.</span> <span class="nav-text">处理 API 响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%93%8D%E5%BA%94%E5%AD%97%E5%85%B8"><span class="nav-number">3.1.5.</span> <span class="nav-text">处理响应字典</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0%E6%9C%80%E5%8F%97%E6%AC%A2%E8%BF%8E%E7%9A%84%E4%BB%93%E5%BA%93"><span class="nav-number">3.1.6.</span> <span class="nav-text">概述最受欢迎的仓库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E8%A7%86-API-%E7%9A%84%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6"><span class="nav-number">3.1.7.</span> <span class="nav-text">监视 API 的速率限制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Pygal-%E5%8F%AF%E8%A7%86%E5%8C%96%E4%BB%93%E5%BA%93"><span class="nav-number">3.2.</span> <span class="nav-text">使用 Pygal 可视化仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%B9%E8%BF%9B-Pygal-%E5%9B%BE%E8%A1%A8"><span class="nav-number">3.2.1.</span> <span class="nav-text">改进 Pygal 图表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E6%8F%90%E7%A4%BA"><span class="nav-number">3.2.2.</span> <span class="nav-text">添加自定义工具提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE%E6%95%B0%E6%8D%AE%E7%BB%98%E5%9B%BE"><span class="nav-number">3.2.3.</span> <span class="nav-text">根据数据绘图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%9B%BE%E8%A1%A8%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%8F%AF%E5%8D%95%E5%87%BB%E7%9A%84%E9%93%BE%E6%8E%A5"><span class="nav-number">3.2.4.</span> <span class="nav-text">在图表中添加可单击的链接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hacker-News-API"><span class="nav-number">3.3.</span> <span class="nav-text">Hacker News API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">4.</span> <span class="nav-text">问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Jupyter-Notebook-%E7%94%A8matplotlib%E4%BD%9C%E5%9B%BE%E6%98%BE%E7%A4%BA%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81"><span class="nav-number">4.1.</span> <span class="nav-text">Jupyter Notebook 用matplotlib作图显示中文乱码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%9C%A8%E6%9E%81%E7%AB%AF%E5%80%BC%E5%B9%B2%E6%89%B0"><span class="nav-number">4.2.</span> <span class="nav-text">存在极端值干扰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E5%BD%A2%E5%9B%BE%E5%92%8C%E7%9B%B4%E6%96%B9%E5%9B%BE%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">4.3.</span> <span class="nav-text">条形图和直方图的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%9B%BE%E6%97%B6x%E8%BD%B4-y%E8%BD%B4%E7%9A%84%E5%88%BB%E5%BA%A6%E6%A0%87%E7%AD%BE%E9%87%8D%E5%8F%A0"><span class="nav-number">4.4.</span> <span class="nav-text">绘图时x轴&#x2F;y轴的刻度标签重叠</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pandas%E5%B8%B8%E7%94%A8%E5%9B%BE%E8%A1%A8%E7%AE%80%E4%BB%8B"><span class="nav-number">5.</span> <span class="nav-text">Pandas常用图表简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%B1%E7%BA%BF%E5%9B%BE-%E7%AE%B1%E5%9E%8B%E5%9B%BE-%E7%9B%92%E5%9E%8B%E5%9B%BE"><span class="nav-number">5.1.</span> <span class="nav-text">箱线图(箱型图&#x2F;盒型图)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E6%96%87%E5%AD%A6%E4%BC%9Amatplotlib%E7%BB%98%E5%9B%BE"><span class="nav-number">6.</span> <span class="nav-text">一文学会matplotlib绘图</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Hunter</p>
  <div class="site-description" itemprop="description">Tough times never last, but tough people do.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">175</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hunter1023.github.io/2020/06/28/Python%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Hunter">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Talk is cheap">
      <meta itemprop="description" content="Tough times never last, but tough people do.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Python项目——数据可视化 | Talk is cheap">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Python项目——数据可视化<a href="https://github.com/Hunter1023/hexo_blog/edit/gh-pages/source/_posts/Python%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-28 11:45:57" itemprop="dateCreated datePublished" datetime="2020-06-28T11:45:57+08:00">2020-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-23 23:29:13" itemprop="dateModified" datetime="2025-01-23T23:29:13+08:00">2025-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">数据分析</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="生成数据"><a href="#生成数据" class="headerlink" title="生成数据"></a>生成数据</h2><ul>
<li>数据<strong>可视化</strong>：通过可视化表示来探索数据</li>
<li>数据<strong>挖掘</strong>：使用代码来探索<strong>数据集的规律和关联</strong></li>
</ul>
<h3 id="安装-matplotlib"><a href="#安装-matplotlib" class="headerlink" title="安装 matplotlib"></a>安装 matplotlib</h3><h4 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h4><p><strong>pip</strong>是一个以Python写成的<strong>软件包管理系统</strong>，它可以<strong>安装和管理软件包</strong>。</p>
<p>大多数较新的Python版本都自带pip，因此首先可检查系统是否已经安装了pip。</p>
<ul>
<li><p>在Windows系统中检查是否安装了pip</p>
<p>  打开一个终端窗口，并执行如下命令：</p>
  <pre class="line-numbers language-none"><code class="language-none">&gt; python -m pip --version
pip 20.1.1 from C:\Users\Hunter\AppData\Local\Programs\Python\Python38-32\lib\site-packages\pip (python 3.8)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<hr>
<h4 id="在-Windows-系统中安装-matplotlib"><a href="#在-Windows-系统中安装-matplotlib" class="headerlink" title="在 Windows 系统中安装 matplotlib"></a>在 Windows 系统中安装 matplotlib</h4><p>在Windows系统中，首先需要<strong>安装Visual Studio</strong>。接下来，访问<a target="_blank" rel="noopener" href="https://pypi.org/project/matplotlib/#files">matplotlib · PyPI</a>，查找与使用的Python版本、操作系统相匹配的<code>.whl</code>文件。</p>
<p>将这个<code>.whl</code>文件复制到<strong>项目所在文件夹</strong>，打开命令窗口，使用pip来安装matplotlib:</p>
<pre class="line-numbers language-none"><code class="language-none">python -m pip install --user matplotlib-3.2.2-cp38-cp38-win32.whl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h4 id="测试-matplotlib"><a href="#测试-matplotlib" class="headerlink" title="测试 matplotlib"></a>测试 matplotlib</h4><p>安装必要的包后，对安装进行测试。为此，首先使用命令python或python3启动一个终端会话，再尝试导入matplotlib:</p>
<pre class="line-numbers language-none"><code class="language-none">$ python3
&gt;&gt;&gt; import matplotlib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果<strong>没有出现任何错误消息，就说明成功安装了 matplotlib</strong>。</p>
<hr>
<h3 id="绘制简单的折线图"><a href="#绘制简单的折线图" class="headerlink" title="绘制简单的折线图"></a>绘制简单的折线图</h3><p>我们将使用平方数序列1、4、9、16和25来绘制这个图表。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token operator">%</span>matplotlib inline <span class="token comment"># 让生成的图形嵌入jupyter notebook中</span>

    squares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>squares<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><strong>模块pyplot</strong>包含很多用于生成图表的函数。</p>
</li>
<li><p><code>plt.show()</code>打开<strong>matplotlib查看器</strong>，并显示绘制的图形。查看器能够<strong>缩放和导航图形</strong>，另外，<strong>单击磁盘图表可将图形保存起来</strong>。</p>
</li>
</ul>
<h4 id="修改标签文字和线条粗细"><a href="#修改标签文字和线条粗细" class="headerlink" title="修改标签文字和线条粗细"></a>修改标签文字和线条粗细</h4><p>上述代码通过matplotlib查看器显示的图形，<strong>标签文字太小、线条太细</strong>。下面通过一些定制来改善这个图形的可读性：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

squares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>squares<span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表标题，并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Square Numbers"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Square of Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

<span class="token comment"># 设置刻度标记的大小</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>参数linewidth</strong>决定了<code>plot()</code>绘制的<strong>线条的粗细</strong></li>
<li>函数<code>title()</code>给图表<strong>指定标题</strong></li>
<li>参数fontsize指定了图表中<strong>文字的大小</strong></li>
<li>函数<code>xlabel()</code>和<code>ylabel()</code></li>
<li>函数<code>tick_params()</code>设置<strong>刻度的样式</strong></li>
</ul>
<hr>
<h4 id="校正图形"><a href="#校正图形" class="headerlink" title="校正图形"></a>校正图形</h4><p>图形更容易阅读后，我们发现<strong>没有正确地绘制数据</strong>：折线图的终点指出4.0的平方为25。下面来修复这个问题。</p>
<p><strong>当你向<code>plot()</code>提供一系列数字时，它假设第一个数据点对应的x坐标值为0</strong>，但我们的第一个点对应的x值为1。为改变这种默认行为，我们可以给<code>plot()</code><strong>同时提供输入值和输出值</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

input_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
squares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>input_values<span class="token punctuation">,</span> squares<span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表标题，并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Square Numbers"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Square of Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

<span class="token comment"># 设置刻度标记的大小</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="使用-scatter-绘制散点图并设置其样式"><a href="#使用-scatter-绘制散点图并设置其样式" class="headerlink" title="使用 scatter() 绘制散点图并设置其样式"></a>使用 <code>scatter()</code> 绘制散点图并设置其样式</h4><p>有时候，需要<strong>绘制散点图</strong>并<strong>设置各个数据点的样式</strong>。例如，你可能想<strong>以一种颜色显示较小的值</strong>，用<strong>另一种颜色显示较大的值</strong>。绘制大型数据集时，还可以<strong>对每个点都设置相同的样式，再使用不同的样式选项重新绘制某些点，以突出它们</strong>。</p>
<p><strong>要绘制简单的点，可使用函数<code>scatter()</code>，并向它传递一对x和y坐标，它将在指定位置绘制一个点</strong>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面来<strong>设置输出的样式</strong>，使其更有趣：添加标题，给轴加上标签，并<strong>确保所有文本都大到能够看清</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表标题并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Square Numbers"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Square of Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

<span class="token comment"># 设置刻度标记的大小</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token comment"># 显示图例</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>plt.scatter(2, 4, s=200)</code>：<strong>实参s设置了</strong>绘制图形时使用的<strong>点的尺寸</strong></li>
</ul>
<hr>
<h4 id="使用-scatter-绘制一系列点"><a href="#使用-scatter-绘制一系列点" class="headerlink" title="使用 scatter() 绘制一系列点"></a>使用 scatter() 绘制一系列点</h4><p>要绘制一系列的点，可向<code>scatter()</code>传递两个<strong>分别包含x值和y值的列表</strong>，如下所示：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

x_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
y_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> y_values<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表标题并给坐标轴加上标签</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 绘制一个展示 船票Fare 与 乘客年龄和性别 之间关系的散点图</span>


<span class="token comment"># 方式一</span>
<span class="token comment"># 利用query对性别和年龄进行筛选</span>
x_values_1 <span class="token operator">=</span> titanic<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"Sex == 'male' &amp; Age != 'NaN'"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span>
y_values_1 <span class="token operator">=</span> titanic<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"Sex == 'male' &amp; Age != 'NaN'"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span>

x_values_2 <span class="token operator">=</span> titanic<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"Sex == 'female' &amp; Age != 'NaN'"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span>
y_values_2 <span class="token operator">=</span> titanic<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"Sex == 'female' &amp; Age != 'NaN'"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span>

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_values_1<span class="token punctuation">,</span> y_values_1<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Male'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_values_2<span class="token punctuation">,</span> y_values_2<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Female'</span><span class="token punctuation">)</span>

<span class="token comment"># 方式二</span>
titanic<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>titanic<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'b'</span> <span class="token comment"># 该处loc[]的用法为：指出 符合条件的行的列值 和 列标签</span>
titanic<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'male'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'r'</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> titanic<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> c<span class="token operator">=</span>titanic<span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">)</span>



plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"船票与年龄"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Age"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Fare"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token comment"># 显示图例</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p>可利用<code>query()</code><strong>排除一些极端值的干扰</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 可视化 消费金额和购买数量的关系散点图</span>
gu <span class="token operator">=</span> grouped_user<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'order_amount &lt; 6000'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>gu<span class="token punctuation">[</span><span class="token string">'order_amount'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> gu<span class="token punctuation">[</span><span class="token string">'order_products'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<hr>
<h4 id="自动计算数据"><a href="#自动计算数据" class="headerlink" title="自动计算数据"></a>自动计算数据</h4><p>下面是<strong>绘制1000个点</strong>的代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

x_values <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_values <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> x_values<span class="token punctuation">]</span>

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> y_values<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表标题并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Square Numbers"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Square of Value"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

<span class="token comment"># 设置每个坐标轴的取值范围</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1100000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由于这个数据集较大，我们<strong>将点设置得较小</strong>，并使用函数<code>axis()</code><strong>指定了每个坐标轴的取值范围</strong>。</p>
<hr>
<h4 id="删除数据点的轮廓"><a href="#删除数据点的轮廓" class="headerlink" title="删除数据点的轮廓"></a>删除数据点的轮廓</h4><p>matplotlib允许你<strong>给散点图中的各个点指定颜色</strong>，默认为<strong>蓝色点</strong>和<strong>黑色轮廓</strong>。在散点图包含的数据点不多时效果很好，但<strong>绘制很多点时，黑色轮廓可能会粘连在一起</strong>。</p>
<p>要删除数据点的轮廓，可在调用<code>scatter()</code>时传递实参<code>edgecolor=&#39;none&#39;</code>：</p>
<p><code>plt.scatter(x_values, y_values, edgecolor=&#39;none&#39;, s=40)</code></p>
<p>注意：matplotlib 2.0.0版本之后，<code>scatter()</code>函数的<strong>实参edgecolor默认为</strong><code>’none&#39;</code>。</p>
<hr>
<h4 id="自定义颜色"><a href="#自定义颜色" class="headerlink" title="自定义颜色"></a>自定义颜色</h4><p>要<strong>修改数据点的颜色</strong>，可向<code>scatter()</code>传递<strong>参数c</strong>，并将其<strong>设置为要使用的颜色的名称</strong>，如下所示：</p>
<p><code>plt.scatter(x_values, y_values, c=&#39;red&#39;, s=40)</code></p>
<p>还可以使用RGB颜色模式自定义颜色：</p>
<p><code>plt.scatter(x_values, y_values, c=(0, 0, 0.8), s=40)</code></p>
<p><strong>值越接近0，指定的颜色越深，值越接近1，指定的颜色越浅</strong>。</p>
<hr>
<h4 id="使用颜色映射"><a href="#使用颜色映射" class="headerlink" title="使用颜色映射"></a>使用颜色映射</h4><p><strong>颜色映射</strong>(<strong>colormap</strong>)是一系列颜色，它们<strong>从起始颜色渐变到结束颜色</strong>。在可视化中，<strong>颜色映射用于突出数据的规律</strong>，例如你可能用较浅的颜色来显示较小的值，并用较深的颜色来显示较大的值。</p>
<p><strong>模块pyplot内置了一组颜色映射</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

x_values <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_values <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> x_values<span class="token punctuation">]</span>

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> y_values<span class="token punctuation">,</span> c<span class="token operator">=</span>y_values<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表标题并给坐标轴加上标签</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们<strong>将参数c设置成了一个y值列表</strong>，并<strong>使用参数cmap告诉pyplot使用哪个颜色映射</strong>。y值较小的点显示为浅蓝色，y值较大的点显示为深蓝色。</p>
<p>注意：要了解pyplot中所有的颜色映射，访问<a target="_blank" rel="noopener" href="https://matplotlib.org/gallery/color/colormap_reference.html#sphx-glr-gallery-color-colormap-reference-py">Colormap reference</a></p>
<hr>
<h4 id="自动保存图表"><a href="#自动保存图表" class="headerlink" title="自动保存图表"></a>自动保存图表</h4><p>要让程序<strong>自动将图表保存到文件中</strong>，可将对<code>plt.show()</code>的调用替换为对<code>plt.savefig()</code>的调用：</p>
<p><code>plt.savefig(&#39;suqares_plot.png&#39;, bbox_inches=&#39;tight&#39;)</code></p>
<ul>
<li>第一个实参指定要以什么样的文件名保存图表，这个文件将<strong>存储到当前程序所在的目录中</strong>。</li>
<li>第二个实参指定<strong>将图表多余的空白区域剪掉</strong>。如果要保留图表周围多余的空白区域，可<strong>省略这个实参</strong>。</li>
</ul>
<hr>
<h3 id="绘制饼图"><a href="#绘制饼图" class="headerlink" title="绘制饼图"></a>绘制饼图</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/38160291">matplotlib可视化饼图 - 知乎</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 绘制一个展示男女乘客比例的扇形图</span>
males <span class="token operator">=</span> <span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'male'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
females <span class="token operator">=</span> <span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'female'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

proportions <span class="token operator">=</span> <span class="token punctuation">[</span>males<span class="token punctuation">,</span> females<span class="token punctuation">]</span>

<span class="token comment"># 绘制饼图</span>
plt<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>
    proportions<span class="token punctuation">,</span>
    
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Males'</span><span class="token punctuation">,</span> <span class="token string">'Females'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    
    <span class="token comment">#是否 添加阴影效果</span>
    shadow <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
    
    <span class="token comment"># 指定填充色</span>
    colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    
    <span class="token comment"># 每一块偏移中心的距离</span>
    explode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.15</span> <span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment"># 饼图的初始摆放角度，默认图是从x轴正方向逆时针画起,如设定=90则从y轴正方向画起</span>
    startangle <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">,</span>
    
    <span class="token comment"># 显示百分比, 小数点前后表示最少的位数 末尾两个%%是输出%自身</span>
    autopct <span class="token operator">=</span> <span class="token string">'%1.1f%%'</span>
    
<span class="token punctuation">)</span>


<span class="token comment"># x，y轴刻度设置一致，保证饼图为圆形</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表标题</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"男女乘客比例"</span><span class="token punctuation">)</span>

<span class="token comment"># tight_layout会自动调整子图参数，使之填充整个图像区域</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<hr>
<h3 id="随机漫步"><a href="#随机漫步" class="headerlink" title="随机漫步"></a>随机漫步</h3><p><strong>随机漫步</strong>是这样行走得到的<strong>路径</strong>：<strong>每次行走都完全是随机的，没有明确的方向，结果是由一系列随机决策决定的</strong>。在自然界、物理学、生物学、化学和经济领域，随机漫步都有其实际用途。例如，漂浮在水滴上的花粉因不断受到水分子的挤压而在水面上移动。水滴中的分子运动是随机的，因此花粉在水面上的运动路径犹如随机漫步。</p>
<h4 id="创建-RandomWalk-类"><a href="#创建-RandomWalk-类" class="headerlink" title="创建 RandomWalk() 类"></a>创建 RandomWalk() 类</h4><p>创建一个<code>RandomWalk()</code>类，这个类需要三个属性：</p>
<ol>
<li>存储随机漫步次数的变量</li>
<li>随机漫步经过的每个点的x坐标</li>
<li>随机漫步经过的每个点的y坐标</li>
</ol>
<p><code>RandomWalk()</code>类只包含两个方法：</p>
<ol>
<li><code>__init__()</code></li>
<li><code>fill_walk()</code>：计算随机漫步<strong>经过的所有点</strong></li>
</ol>
<p>先来看看<code>__init__()</code>:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> random <span class="token keyword">import</span> choice

<span class="token keyword">class</span> <span class="token class-name">RandomWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""一个生成随机漫步数据的类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_points<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""初始化随机漫步的属性"""</span>
        self<span class="token punctuation">.</span>num_points <span class="token operator">=</span> num_points
        
        <span class="token comment"># 所有随机漫步都始于(0, 0)</span>
        self<span class="token punctuation">.</span>x_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>y_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>为做出随机决策，我们<strong>将所有可能的选择都存储在一个列表中</strong>，并<strong>在每次做决策时都使用<code>choice()</code>来决定使用哪种选择</strong>。</p>
<hr>
<h4 id="选择方向"><a href="#选择方向" class="headerlink" title="选择方向"></a>选择方向</h4><p>我们将使用<code>fill_walk()</code>来生成漫步包含的点，并决定每次漫步的方向，如下所示：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">fill_walk</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算随机漫步包含的所有点"""</span>
        
        <span class="token comment"># 不断漫步，直到列表到达指定的长度</span>
        <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x_values<span class="token punctuation">)</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>num_points<span class="token punctuation">:</span>
            <span class="token comment"># 决定前进方向以及沿这个方向前进的距离</span>
            x_direction <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            x_distance <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            x_step <span class="token operator">=</span> x_direction <span class="token operator">*</span> x_distance
            
            y_direction <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            y_distance <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            y_step <span class="token operator">=</span> y_direction <span class="token operator">*</span> y_distance
            
            <span class="token comment"># 拒绝原地踏步</span>
            <span class="token keyword">if</span> x_step <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> y_step <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
                
            <span class="token comment"># 计算下一个点的x和y值</span>
            next_x <span class="token operator">=</span> self<span class="token punctuation">.</span>x_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> x_step
            next_y <span class="token operator">=</span> self<span class="token punctuation">.</span>y_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> y_step
            
            self<span class="token punctuation">.</span>x_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_x<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>y_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>choice([-1, 1])</code>：<strong>从-1和1中随机选择一个值</strong></li>
<li><code>choice([0, 1, 2, 3, 4])</code>：<strong>从0~4中随机选择一个值</strong></li>
</ul>
<hr>
<h4 id="绘制随机漫步图"><a href="#绘制随机漫步图" class="headerlink" title="绘制随机漫步图"></a>绘制随机漫步图</h4><p><strong>rw_visual.py</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">from</span> random_walk <span class="token keyword">import</span> RandomWalk

<span class="token comment"># 创建一个RandomWalk实例，并将其包含的点都绘制出来</span>
rw <span class="token operator">=</span> RandomWalk<span class="token punctuation">(</span><span class="token punctuation">)</span>
rw<span class="token punctuation">.</span>fill_walk<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="模拟多次随机漫步"><a href="#模拟多次随机漫步" class="headerlink" title="模拟多次随机漫步"></a>模拟多次随机漫步</h4><p>要在不多次运行程序的情况下<strong>模拟多次随机漫步</strong>，一种办法是<strong>将这些代码放在一个while循环中</strong>，如下所示：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">from</span> random_walk <span class="token keyword">import</span> RandomWalk

<span class="token comment"># 只要程序处于活动状态，就不断地模拟随机漫步</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个RandomWalk实例，并将其包含的点都绘制出来</span>
	rw <span class="token operator">=</span> RandomWalk<span class="token punctuation">(</span><span class="token punctuation">)</span>
	rw<span class="token punctuation">.</span>fill_walk<span class="token punctuation">(</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	keep_running <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Make another walk? (y/n): "</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> keep_running <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">:</span>
		<span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="给点着色"><a href="#给点着色" class="headerlink" title="给点着色"></a>给点着色</h4><p>我们将使用<strong>颜色映射</strong>来指出漫步中各点的<strong>先后顺序</strong>。为根据漫步中各点的先后顺序进行着色，我们<strong>传递参数c</strong>，并将其<strong>设置为一个列表</strong>，其中<strong>包含各点的先后顺序</strong>。</p>
<p><strong>由于这些点是按顺序绘制的，因此给参数c指定的列表只需包含数字1~5000</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个RandomWalk实例，并将其包含的点都绘制出来</span>
	rw <span class="token operator">=</span> RandomWalk<span class="token punctuation">(</span><span class="token punctuation">)</span>
	rw<span class="token punctuation">.</span>fill_walk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
	point_numbers <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>rw<span class="token punctuation">.</span>num_points<span class="token punctuation">)</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">,</span> c<span class="token operator">=</span>point_numbers<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	keep_running <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Make another walk? (y/n): "</span><span class="token punctuation">)</span>
	<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="重新绘制起点和终点"><a href="#重新绘制起点和终点" class="headerlink" title="重新绘制起点和终点"></a>重新绘制起点和终点</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">,</span> c<span class="token operator">=</span>point_numbers<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 突出起点和终点</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="隐藏坐标轴"><a href="#隐藏坐标轴" class="headerlink" title="隐藏坐标轴"></a>隐藏坐标轴</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 隐藏坐标轴</span>
    plt<span class="token punctuation">.</span>axes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_xaxis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_yaxis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>为修改坐标轴，使用了函数<code>plt.axes()</code>来将每条坐标轴的可见性设置为False。</p>
<hr>
<h4 id="增加点数"><a href="#增加点数" class="headerlink" title="增加点数"></a>增加点数</h4><p>在创建RandomWalk实例时<strong>增大num_points的值，并在绘图时调整每个点的大小</strong>，如下所示：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个RandomWalk实例，并将其包含的点都绘制出来</span>
    rw <span class="token operator">=</span> RandomWalk<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
    rw<span class="token punctuation">.</span>fill_walk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 绘制点并将图形显示出来</span>
    point_numbers <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>rw<span class="token punctuation">.</span>num_points<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">,</span> c<span class="token operator">=</span>point_numbers<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="调整尺寸以适合屏幕"><a href="#调整尺寸以适合屏幕" class="headerlink" title="调整尺寸以适合屏幕"></a>调整尺寸以适合屏幕</h4><p>图表适合屏幕大小时，更能有效地将数据中的规律呈现出来。为<strong>让绘图窗口更适合屏幕大小</strong>，可像下面这样<strong>调整matplotlib输出的尺寸</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个RandomWalk实例，并将其包含的点都绘制出来</span>
	rw <span class="token operator">=</span> RandomWalk<span class="token punctuation">(</span><span class="token punctuation">)</span>
	rw<span class="token punctuation">.</span>fill_walk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 设置绘图窗口的尺寸</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数<code>figure()</code>用于<strong>指定图表的宽度、高度、分辨率和背景色</strong>：</p>
<p>需要给形参<code>figsize</code><strong>指定一个元组</strong>，向matplotlib<strong>指出绘图窗口的尺寸</strong>，<strong>单位为英寸</strong>。</p>
<p>Python<strong>假定屏幕分辨率为80像素&#x2F;英寸</strong>，如果知道自己系统的分辨率，可使用形参dpi向<code>figure()</code>传递该分辨率，以有效利用可用的屏幕空间：</p>
<p><code>plt.figure(dpi=128, figsize=(10, 6))</code></p>
<hr>
<h3 id="使用-Pygal-模拟掷骰子"><a href="#使用-Pygal-模拟掷骰子" class="headerlink" title="使用 Pygal 模拟掷骰子"></a>使用 Pygal 模拟掷骰子</h3><p>本节将使用Python<strong>可视化包Pygal</strong>来生成可缩放的<strong>矢量图形文件</strong>，它们将<strong>自动缩放</strong>，以适合观看者的屏幕。如果你打算以在线的方式使用图表，请考虑使用Pygal来生成它们，这样在任何设备上显示都会很美观。</p>
<p>在这个项目中，我们将对掷骰子的结果进行分析。为确定哪些点数出现的可能性最大，我们将<strong>生成一个表示掷骰子结果的数据集，并根据结果绘制出一个图形</strong>。</p>
<h4 id="安装-Pygal"><a href="#安装-Pygal" class="headerlink" title="安装 Pygal"></a>安装 Pygal</h4><p>在 Windows 系统中，命令：</p>
<p><code>python -m pip install --user pygal==1.7</code></p>
<hr>
<h4 id="Paygal-画廊"><a href="#Paygal-画廊" class="headerlink" title="Paygal 画廊"></a>Paygal 画廊</h4><p>要了解使用Pygal可创建什么样的图表，可以查看<a target="_blank" rel="noopener" href="http://www.pygal.org/en/stable/documentation/types/index.html">Chart types — pygal documentation</a></p>
<hr>
<h4 id="创建-Die-类"><a href="#创建-Die-类" class="headerlink" title="创建 Die 类"></a>创建 Die 类</h4><p>下面的类模拟掷一个骰子：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> random <span class="token keyword">import</span> randint

<span class="token keyword">class</span> <span class="token class-name">Die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""表示一个骰子的类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_sides<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""骰子默认为6面"""</span>
        self<span class="token punctuation">.</span>num_sides <span class="token operator">=</span> num_sides
        
    <span class="token keyword">def</span> <span class="token function">roll</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""返回一个位于1和骰子面数之间的随机数"""</span>
        <span class="token keyword">return</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_sides<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>方法<code>roll()</code>使用函数<code>randint()</code>来<strong>返回一个1和面数之间的随机整数(包括起始值1和终止值num_sides)</strong></li>
</ul>
<p>骰子根据面数命名，6面的骰子命名为D6，8面的骰子命名为D8。</p>
<hr>
<h4 id="掷骰子"><a href="#掷骰子" class="headerlink" title="掷骰子"></a>掷骰子</h4><p>使用这个类来创建图表前，先来掷D6骰子，将结果打印出来，并检查结果是否合理：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token comment"># 创建一个D6</span>
die <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 掷几次骰子，并将结果存储在一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
<span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="分析结果"><a href="#分析结果" class="headerlink" title="分析结果"></a>分析结果</h4><p>为分析掷一个D6骰子的结果，我们<strong>计算每个点数出现的次数</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 掷几次骰子，并将结果存储在一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> die<span class="token punctuation">.</span>num_sides<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frequency <span class="token operator">=</span> results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    frequencies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frequency<span class="token punctuation">)</span>
    
<span class="token keyword">print</span><span class="token punctuation">(</span>frequencies<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>为分析结果，我们创建了空列表frequencies，用于存储每种点数出现的次数</li>
</ul>
<hr>
<h4 id="绘制条形图-bar-chart"><a href="#绘制条形图-bar-chart" class="headerlink" title="绘制条形图(bar chart)"></a>绘制条形图(bar chart)</h4><p>有了频率列表后，我们就可以绘制一个表示结果的<strong>条形图(bar chart)</strong>，<strong>指出各种结果出现的频率</strong>。</p>
<ol>
<li><strong>利用pygal绘制</strong></li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pygal
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> die<span class="token punctuation">.</span>num_sides<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frequency <span class="token operator">=</span> results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    frequencies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frequency<span class="token punctuation">)</span>
    
<span class="token comment"># 对结果进行可视化</span>
bar <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>

bar<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Results of rolling one D6 1000 times."</span>
bar<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">]</span>
bar<span class="token punctuation">.</span>x_title <span class="token operator">=</span> <span class="token string">"Result"</span>
bar<span class="token punctuation">.</span>y_title <span class="token operator">=</span> <span class="token string">"Frequency of Result"</span>

bar<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'D6'</span><span class="token punctuation">,</span> frequencies<span class="token punctuation">)</span>
bar<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'die_visual.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>为创建<strong>条形图(bar diagram)</strong>，创建了一个<code>pygal.Bar()</code>实例</li>
<li>将D6骰子的可能结果用作x轴的标签</li>
<li>使用<code>add()</code>将一系列值添加到图表中(传递<strong>给添加的值指定的标签</strong>、<strong>将出现在图表中的值的列表</strong>)</li>
<li>将图表<strong>渲染为一个SVG文件</strong>(Scalable Vector Graphics，可缩放的矢量图形，是一种<strong>基于XML</strong>的<strong>图像文件格式</strong>)</li>
</ul>
<p>要查看生成的直方图，最简单的方式是使用Web浏览器。为此，在任意浏览器中新建一个标签页，再打开文件die_visual.svg，将看到对应的图表。</p>
<p>注意：Python让这个图表具有交互性：<strong>如果将鼠标指向该图表中的任何条形，将看到与之相关联的数据</strong>(若无效果，刷新)。</p>
<hr>
<h4 id="绘制直方图-histogram"><a href="#绘制直方图-histogram" class="headerlink" title="绘制直方图(histogram)"></a>绘制直方图(histogram)</h4><ol>
<li><strong>利用pyplot绘制</strong></li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token comment"># 绘制一个展示船票价格的直方图</span>

<span class="token comment"># 创建直方图</span>
<span class="token comment"># 参数：需要计算的series ，bins可以是直方图个数(默认为10)，也可以是自定义的序列</span>
plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bins <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Set the title and labels</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Fare'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Frequency'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'船票价格分布'</span><span class="token punctuation">)</span>

<span class="token comment"># show the plot</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 用户消费金额的分布图，利用query消除极值对可视化呈现效果的干扰</span>
plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>grouped_user<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'order_amount &lt; 1000'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'order_amount'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bins <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="同时掷两个骰子"><a href="#同时掷两个骰子" class="headerlink" title="同时掷两个骰子"></a>同时掷两个骰子</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pygal

<span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token comment"># 创建两个D6骰子</span>
die_1 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
die_2 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 掷骰子多次，并将结果存储到一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die_1<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> die_2<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
max_result <span class="token operator">=</span> die_1<span class="token punctuation">.</span>num_sides <span class="token operator">+</span> die_2<span class="token punctuation">.</span>num_sides
<span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> max_result<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frequency <span class="token operator">=</span> results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    frequencies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frequency<span class="token punctuation">)</span>
    
<span class="token comment"># 可视化结果</span>
bar <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>

bar<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Results of rolling two D6 dice 1000 times."</span>
bar<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'11'</span><span class="token punctuation">,</span> <span class="token string">'12'</span><span class="token punctuation">]</span>
bar<span class="token punctuation">.</span>x_title <span class="token operator">=</span> <span class="token string">"Result"</span>
bar<span class="token punctuation">.</span>y_title <span class="token operator">=</span> <span class="token string">"Frequency of Result"</span>

bar<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'D6 + D6'</span><span class="token punctuation">,</span> frequencies<span class="token punctuation">)</span>
bar<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'dice_visual.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="同时掷两个面数不同的骰子"><a href="#同时掷两个面数不同的骰子" class="headerlink" title="同时掷两个面数不同的骰子"></a>同时掷两个面数不同的骰子</h4><p>下面来创建一个6面骰子和一个10面骰子，看看同时掷这两个骰子50000次的结果：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token keyword">import</span> pygal

<span class="token comment"># 创建一个D6和一个D10</span>
die_1 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
die_2 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># 掷骰子多次，并将结果存储到一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die_1<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> die_2<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
max_result <span class="token operator">=</span> die_1<span class="token punctuation">.</span>num_sides <span class="token operator">+</span> die_2<span class="token punctuation">.</span>num_sides
<span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> max_result<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frequency <span class="token operator">=</span> results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    frequencies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frequency<span class="token punctuation">)</span>
    
<span class="token comment"># 可视化结果</span>
bar <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>

bar<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Results of rolling a D6 and a D10 50,000 times."</span>
bar<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
bar<span class="token punctuation">.</span>x_title <span class="token operator">=</span> <span class="token string">"Result"</span>
bar<span class="token punctuation">.</span>y_title <span class="token operator">=</span> <span class="token string">"Frequency of Result"</span>

bar<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'D6 + D10'</span><span class="token punctuation">,</span> frequencies<span class="token punctuation">)</span>
bar<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'dice_visual.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>通过<strong>列表解析</strong>调整x轴标签</li>
</ul>
<hr>
<h2 id="下载数据"><a href="#下载数据" class="headerlink" title="下载数据"></a>下载数据</h2><p>网上的数据多得难以置信，且大多未经过仔细检查。如果能够对这些数据进行分析，你就能发现别人没有发现的规律和关联。</p>
<h3 id="CSV-文件格式"><a href="#CSV-文件格式" class="headerlink" title="CSV 文件格式"></a>CSV 文件格式</h3><p>要在<strong>文本文件</strong>中存储数据，最简单的方式是<strong>将数据作为一系列以逗号分隔的值</strong>(<strong>CSV</strong>, Comma-Separated Values)写入文件，这样的文件称为<strong>CSV文件</strong>。</p>
<p>例如，下面是一行CSV格式的天气数据：</p>
<p><code>2014-1-5,61,44,26,18,7,-1,56,30,9,30.34,30.27,30.15,,,,10,4,,0.00,0,,195</code></p>
<p>CSV文件对人来说阅读起来比较麻烦，但程序可轻松地提取并处理其中的值，这有助于加快数据分析过程。</p>
<ul>
<li>最好<strong>使用用文字编辑器打开csv文件查看</strong>，<strong>Excel可能会更改显示格式</strong></li>
</ul>
<h4 id="分析-CSV-文件头"><a href="#分析-CSV-文件头" class="headerlink" title="分析 CSV 文件头"></a>分析 CSV 文件头</h4><p>csv模块包含在Python标准库中，可用于分析CSV文件中的数据行，让我们能够快速提取感兴趣的值。下面先来看一下<code>sitka_weather_07-2014.csv</code>文件的<strong>第一行</strong>，其中<strong>包含一系列有关数据的描述</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv

filename <span class="token operator">=</span> <span class="token string">'sitka_weather_07-2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>header_row<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>调用<code>csv.reader()</code>，并将前面存储的<strong>文件对象作为实参传入</strong>，从而创建一个与该文件相关联的<strong>阅读器对象</strong></li>
<li><strong>模块csv的reader类</strong>包含<code>next()</code>方法，调用<strong>内置函数<code>next()</code><strong>并</strong>将一个阅读器对象作为参数传入，将调用阅读器对象的<code>next()</code>方法，从而返回文件中的下一行</strong>。</li>
<li>reader处理文件中<strong>以逗号分隔的第一行数据</strong>，并<strong>将每项数据都作为一个元素存储在列表中</strong>。</li>
</ul>
<p>注意：文件头的格式并非总是一致的， <strong>空格和单位可能出现在奇怪的地方，但不会带来任何问题</strong>。</p>
<hr>
<h4 id="打印文件头及其位置"><a href="#打印文件头及其位置" class="headerlink" title="打印文件头及其位置"></a>打印文件头及其位置</h4><p>为让文件头数据更容易理解，将列表中的<strong>每个文件头及其位置</strong>打印出来：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> index<span class="token punctuation">,</span> column_header <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>header_row<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> column_header<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>对列表调用了<code>enumerate()</code>(<strong>枚举</strong>)来获取每个元素的<strong>索引及其值</strong>。</li>
</ul>
<hr>
<h4 id="提取并读取数据"><a href="#提取并读取数据" class="headerlink" title="提取并读取数据"></a>提取并读取数据</h4><p>首先读取<strong>每天的最高气温</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv

<span class="token comment"># 从文件中获取最高气温</span>
filename <span class="token operator">=</span> <span class="token string">'sitka_weather_07-2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    
    highs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
    <span class="token keyword">print</span><span class="token punctuation">(</span>highs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>for row in reader</code>：<strong>遍历</strong>文件中余下的<strong>各行</strong></p>
<p>  每次执行上述循环，我们都将<strong>索引1处</strong>(<strong>第2列</strong>)的数据附加到highs末尾。</p>
</li>
</ul>
<p>下面使用<code>int()</code><strong>将这些字符串转换为数字</strong>，<strong>让matplotlib能够读取它们</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
	highs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        high <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>high<span class="token punctuation">)</span>
        
    <span class="token keyword">print</span><span class="token punctuation">(</span>highs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="绘制气温图表"><a href="#绘制气温图表" class="headerlink" title="绘制气温图表"></a>绘制气温图表</h4><p>为可视化这些气温数据，我们首先使用matplotlib创建一个<strong>显示每日最高气温的简单图形</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv

<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 从文件中获取最高气温</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 根据数据绘制图形</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图形的格式</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Daily high temperatures, July 2014"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Temperature (F)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><strong>鉴于还没有添加日期，因此没有给x轴添加标签</strong></p>
</li>
<li><p><code>tick_params()</code>：</p>
<p>  which一共3个参数：[‘major’ , ‘minor’. ‘both’]<br>  默认是major，表示<strong>主刻度</strong>，后面分布为<strong>次刻度</strong>及<strong>主次刻度都显示.</strong></p>
</li>
<li><p><strong>调整x轴日期的显示间隔</strong></p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'1997-01-01'</span><span class="token punctuation">,</span> <span class="token string">'1997-04-01'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'10d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<hr>
<h4 id="模块-datetime"><a href="#模块-datetime" class="headerlink" title="模块 datetime"></a>模块 datetime</h4><p>下面<strong>在图表中添加日期</strong>。在天气数据文件中，<strong>第一个日期在第二行</strong>：</p>
<p><strong>获取日期数据时，获得的是一个字符串</strong>，因此需要将字符串<code>&#39;2014-7-1&#39;</code><strong>转换为一个表示相应日期的对象</strong>。可使用<strong>模块datetime</strong>中的方法<code>strptime()</code>：</p>
<pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; first_date &#x3D; datetime.strptime(&#39;2014-7-1&#39;, &#39;%Y-%m-%d&#39;)
&gt;&gt;&gt; print(first_date)
2014-07-01 00:00:00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>传入方法<code>strptime()</code>的<strong>第2个实参</strong>告诉Python如何<strong>设置日期的格式</strong>。</p>
<ul>
<li><code>%Y-</code>让Python将字符串中<strong>第一个连字符前面的部分</strong>视为<strong>4位的年份</strong></li>
<li><code>%m-</code>让Python将<strong>第二个连字符前面的部分</strong>视为<strong>表示月份的数字</strong></li>
<li><code>%d</code>让Python将<strong>最后一部分</strong>视为<strong>月份中的一天</strong></li>
</ul>
</li>
<li><p>方法<code>strptime()</code>可接受各种实参，并根据它们来决定如何解读日期：</p>
<table>
<thead>
<tr>
<th>实参</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>%<strong>A</strong></td>
<td><strong>星期</strong>的名称，如Monday</td>
</tr>
<tr>
<td>%<strong>B</strong></td>
<td><strong>月份</strong>名，如January</td>
</tr>
<tr>
<td>%m</td>
<td>用<strong>数字表示的月份</strong> (<strong>0</strong>1~12)</td>
</tr>
<tr>
<td>%d</td>
<td>用<strong>数字表示</strong>月份中的<strong>一天</strong> (<strong>0</strong>1~31)</td>
</tr>
<tr>
<td>%<strong>Y</strong></td>
<td><strong>四位</strong>的年份，如2015</td>
</tr>
<tr>
<td>%<strong>y</strong></td>
<td><strong>两位</strong>的年份，如15</td>
</tr>
<tr>
<td>%<strong>H</strong></td>
<td><strong>24小时制</strong>的小时数 (<strong>0</strong>0-23)</td>
</tr>
<tr>
<td>%<strong>I</strong></td>
<td><strong>12小时制</strong>的小时数 (<strong>0</strong>1~12)</td>
</tr>
<tr>
<td>%<strong>p</strong></td>
<td>am或pm</td>
</tr>
<tr>
<td>%<strong>M</strong></td>
<td>分钟数 (<strong>0</strong>0~59)</td>
</tr>
<tr>
<td>%<strong>S</strong></td>
<td>秒数 (<strong>0</strong>0~<strong>61</strong>)</td>
</tr>
</tbody></table>
</li>
</ul>
<hr>
<h4 id="在图表中添加日期"><a href="#在图表中添加日期" class="headerlink" title="在图表中添加日期"></a>在图表中添加日期</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 从文件中获取日期和最高气温</span>
filename <span class="token operator">=</span> <span class="token string">'sitka_weather_07-2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
        
    dates<span class="token punctuation">,</span> highs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        current_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span>
        dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_date<span class="token punctuation">)</span>
        
        high <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>high<span class="token punctuation">)</span>

<span class="token comment"># 根据数据绘制图形</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图形的格式</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Daily high temperatures, July 2014"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>autofmt_xdate<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 绘制斜的日期标签，以免它们彼此重叠</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Temperature (F)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>创建了两个空列表：<code>dates, highs = [], []</code></li>
<li>将包含日期信息的数据转换为datetime对象：<code>datetime.strptime(row[0], &quot;%Y-%m-%d&quot;)</code></li>
<li>将日期和最高气温值传给<code>plot()</code>：<code>plt.plot(dates, highs, c=&#39;red&#39;)</code></li>
</ul>
<hr>
<h4 id="涵盖更长的时间"><a href="#涵盖更长的时间" class="headerlink" title="涵盖更长的时间"></a>涵盖更长的时间</h4><p>创建<strong>覆盖整年</strong>的天气图：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 从文件中获取日期和最高气温</span>
filename <span class="token operator">=</span> <span class="token string">'stika_weather_2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 设置图形的格式</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Daily high temperatures - 2014"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="再绘制一个数据系列"><a href="#再绘制一个数据系列" class="headerlink" title="再绘制一个数据系列"></a>再绘制一个数据系列</h4><p>从数据文件中提取最低气温，并添加到图表中：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 从文件中获取日期、最高气温和最低气温</span>
filename <span class="token operator">=</span> <span class="token string">'sitka_weather_2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    
    dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        current_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span>
        dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_date<span class="token punctuation">)</span>
        
        high <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>high<span class="token punctuation">)</span>
        
        low <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rpw<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        lows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>low<span class="token punctuation">)</span>
        
<span class="token comment"># 根据数据绘制图形</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图形的格式</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Daily high and low temperatures - 2014"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="给图表区域着色"><a href="#给图表区域着色" class="headerlink" title="给图表区域着色"></a>给图表区域着色</h4><p><strong>通过着色来呈现每天的气温范围</strong>，为此使用方法<code>fill_between()</code>，它<strong>接受一个x值系列和两个y值系列，并填充两个y值系列之间的空间</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 根据数据绘制图形</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">.</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">.</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实参<code>alpha</code>指定<strong>颜色的透明度</strong><ul>
<li><strong>0</strong>表示完全<strong>透明</strong></li>
<li><strong>1(默认)<strong>表示完全</strong>不透明</strong></li>
</ul>
</li>
<li><code>fill_between()</code><ul>
<li>实参<code>facecolor</code>指定了<strong>填充区域的颜色</strong></li>
</ul>
</li>
</ul>
<hr>
<h4 id="错误检查"><a href="#错误检查" class="headerlink" title="错误检查"></a>错误检查</h4><p>我们应该能够使用有关任何地方的天气数据来运行highs_lows.py中的代码，但<strong>有些气象站会偶尔出现故障，未能收集部分或全部其应该收集的数据</strong>。<strong>缺失数据可能会引发异常，如果不妥善地处理，还可能导致程序崩溃</strong>。</p>
<p>例如，我们来看看生成加利福尼亚死亡谷的气温图时出现的情况：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 从文件中获取日期、最高气温和最低气温</span>
filename <span class="token operator">=</span> <span class="token string">'death_valley_2014.csv'</span>
withj <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行结果：</p>
<pre class="line-numbers language-none"><code class="language-none">Traceback (most recent call last):
  File &quot;highs_lows.py&quot;, line 17, in &lt;module&gt;
    high &#x3D; int(row[1])
ValueError: invalid literal for int() with base 10: &#39;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看文件可知，没有记录<strong>2014年2月16日</strong>的数据，<strong>表示最高温度的字符串为空</strong>。为解决这种问题，我们<strong>从CSV文件中读取值时执行错误检查代码，对分析数据集时可能出现的异常进行处理</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 从文件中获取日期、最高气温和最低气温</span>
filename <span class="token operator">=</span> <span class="token string">'death_valley_2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
        
    dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
	        current_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span>
        	high <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            low <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>current_date<span class="token punctuation">,</span> <span class="token string">'missing data'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_date<span class="token punctuation">)</span>
	        highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>high<span class="token punctuation">)</span>
            lows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>low<span class="token punctuation">)</span>
            
<span class="token comment"># 根据数据绘制图形</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 设置图形的格式</span>
title <span class="token operator">=</span> <span class="token string">"Daily high and low temperatures - 2014\nDeath Valley, CA"</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在有些情况下，需要<strong>使用continue来跳过一些数据</strong>，或者<strong>使用<code>remove()</code>(删除列表值)或<code>del</code>(删除 键-值 对)将已提取的数据删除</strong>。可采用任何管用的方法，只要能进行精确而有意义的可视化就好。</p>
<hr>
<h3 id="16-2-比较锡特卡和死亡谷的气温："><a href="#16-2-比较锡特卡和死亡谷的气温：" class="headerlink" title="16-2  比较锡特卡和死亡谷的气温："></a>16-2  比较锡特卡和死亡谷的气温：</h3><p>为准确地比较锡特卡和死亡谷的气温范围，<strong>在y轴上使用相同的刻度</strong>，对两地的气温范围进行直接比较：</p>
<ul>
<li>pyplot的方法<code>ylim()</code>可以<strong>对y轴的刻度做限制</strong>；<code>xlim()</code>则可以对x轴的刻度做限制。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 设置图形的格式</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>尝试<strong>在一个图表中呈现这两个数据集</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token keyword">def</span> <span class="token function">get_weather_data</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""从文件中获取日期、最高气温和最低气温"""</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                current_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span>
                high <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                low <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>current_date<span class="token punctuation">,</span> <span class="token string">'missing data'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_date<span class="token punctuation">)</span>
                highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>high<span class="token punctuation">)</span>
                lows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>low<span class="token punctuation">)</span>

<span class="token comment"># 获取锡特卡的气温数据</span>
dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
get_weather_data<span class="token punctuation">(</span><span class="token string">'stika_weather_2014.csv'</span><span class="token punctuation">,</span> dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">)</span>

<span class="token comment"># 根据锡特卡数据绘制图形</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span>

<span class="token comment"># 获取死亡谷的气温数据</span>
dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
get_weather_data<span class="token punctuation">(</span><span class="token string">'death_valley_2014.csv'</span><span class="token punctuation">,</span> dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">)</span>

<span class="token comment"># 将死亡谷数据的图形 添加到当前的绘制中</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图形的格式</span>
title <span class="token operator">=</span> <span class="token string">"Daily high and low temperatures - 2014"</span>
title <span class="token operator">+=</span> <span class="token string">"\nSitka, AK and Death Valley, CA"</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>autofmt_xdate<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Temperature (F)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="制作交易收盘价走势图：-JSON-格式"><a href="#制作交易收盘价走势图：-JSON-格式" class="headerlink" title="制作交易收盘价走势图： JSON 格式"></a>制作交易收盘价走势图： JSON 格式</h3><h4 id="下载收盘价数据"><a href="#下载收盘价数据" class="headerlink" title="下载收盘价数据"></a>下载收盘价数据</h4><p>btc_close_2017.json实际是一个很长的<strong>Python列表</strong>，其中<strong>每个元素都是一个包含五个键的字典</strong>：统计日期、月份、周数、周几以及收盘价。由于2017年1月1日是周日，作为2017年的第一周实在太短，。因此被计入2016年的第52周。于是2017年的第一周是从1月2日开始的。</p>
<p>可以将<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/muxuezi/btc/master/btc_close_2017.json">收盘价数据文件</a>直接下载到程序所在的文件夹中，也可以用Python <strong>2.x</strong>标准库中模块<strong>urllib2</strong>(Python <strong>3.x</strong>版本使用<strong>urllib</strong>)的函数<code>urlopen()</code>来做，还可以通过Python的<strong>第三方模块requests</strong>下载数据。</p>
<p>如果采用函数<code>urlopen()</code>来下载数据，可以使用如下代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> <span class="token punctuation">(</span>absolute_import<span class="token punctuation">,</span> division<span class="token punctuation">,</span> print_function<span class="token punctuation">,</span> unicode_literals<span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># Python 2.x 版本</span>
    <span class="token keyword">from</span> urllib2 <span class="token keyword">import</span> urlopen
<span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
    <span class="token comment"># Python 3.x 版本</span>
    <span class="token keyword">from</span> urllib<span class="token punctuation">.</span>request <span class="token keyword">import</span> urlopen
<span class="token keyword">import</span> json

json_url <span class="token operator">=</span> <span class="token string">'https://raw.githubusercontent.com/muxuezi/btc/master/btc_close_2017.json'</span>
response <span class="token operator">=</span> urlopen<span class="token punctuation">(</span>json_url<span class="token punctuation">)</span>
<span class="token comment"># 读取数据</span>
req <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 将数据写入文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'btc_close_2017_urllib.json'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token comment"># 加载json格式</span>
file_urllib <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>file_urllib<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yizhuanlu9607/article/details/78084266">python打开文件时w与wb的区别,r与rb的区别</a></p>
<p>  在<strong>Windows</strong>中的<strong>换行符</strong>是<code>\r\n</code>。</p>
<ul>
<li>以<strong>文本方式</strong>(<code>&#39;w&#39;</code>)<strong>写入</strong>，遇到<code>\n</code>会<strong>自动替换</strong>为<code>\r\n</code></li>
<li>以<strong>二进制文本方式</strong>(<code>&#39;wb&#39;</code>)写入，遇到<code>\n</code><strong>仍然按</strong><code>\n</code>记录</li>
</ul>
</li>
<li><p><code>json</code></p>
<ul>
<li><p><code>load()</code></p>
<p>  载入<strong>json文件</strong></p>
</li>
<li><p><code>loads()</code></p>
<p>  载入JSON格式的<strong>字符串</strong></p>
</li>
</ul>
</li>
</ul>
<p>函数urlopen的代码稍微复杂一些，<strong>第三方模块requests</strong>封装了许多常用的方法，<strong>让数据下载和读取方式变得非常简单</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

json_url <span class="token operator">=</span> <span class="token string">'https://raw.githubusercontent.com/muxuezi/btc/master/btc_close_2017.json'</span>
req <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>json_url<span class="token punctuation">)</span>
<span class="token comment"># 将数据写入文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'btc_close_2017_request.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>req<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
file_requests <span class="token operator">=</span> req<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>req.text</code>属性可以<strong>直接读取文件数据</strong>，<strong>返回格式是字符串</strong></li>
<li><code>req.json()</code>可以将json文件的数据<strong>转换为Python列表</strong>，与之前的<code>file_urllib</code><strong>内容相同</strong></li>
</ul>
<hr>
<h4 id="提取相关的数据"><a href="#提取相关的数据" class="headerlink" title="提取相关的数据"></a>提取相关的数据</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> json

<span class="token comment"># 将数据加载到一个列表中</span>
filename <span class="token operator">=</span> <span class="token string">'btc_close_2017.json'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    btc_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token comment"># 打印每一天的信息</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    date <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span>
    month <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span>
    week <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span>
    weekday <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span>
    close <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; is month &#123;&#125; week &#123;&#125;, &#123;&#125;, the close price is &#123;&#125; RMB"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> month<span class="token punctuation">,</span> week<span class="token punctuation">,</span> weekday<span class="token punctuation">,</span> close<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="将字符串转换为数字值"><a href="#将字符串转换为数字值" class="headerlink" title="将字符串转换为数字值"></a>将字符串转换为数字值</h4><p>btc_close_2017.json中的每个键和值都是字符串。为了能在后边的内容中<strong>对交易数据进行计算</strong>，需要先将<strong>表示周数和收盘价的字符串转换为数值</strong>，因此使用函数<code>int()</code>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 打印每一天的信息</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    date <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span>
    month <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    week <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    weekday <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span>
    close <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; is month &#123;&#125; week &#123;&#125;, &#123;&#125;, the close price is &#123;&#125; RMB"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> month<span class="token punctuation">,</span> week<span class="token punctuation">,</span> weekday<span class="token punctuation">,</span> close<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>在实际工作中，原始数据的格式经常是不统一的</strong>。此类数值类型转换造成的<strong>ValueError异常十分普遍</strong>。该例子中，<strong>无法将包含小数点的字符串转换为整数</strong>，因此需要<strong>先转换为浮点数再转换为整数</strong>：<code>int(float(btc_dict[&#39;close&#39;]))</code></li>
</ul>
<p>有了这些数据之后，可以<strong>结合Pygal的可视化功能来探索一些有趣的信息</strong>。</p>
<hr>
<h4 id="绘制收盘价折线图"><a href="#绘制收盘价折线图" class="headerlink" title="绘制收盘价折线图"></a>绘制收盘价折线图</h4><p>之前章节介绍过<strong>用Pygal绘制条形图(bar chart)<strong>的方法，也介绍了</strong>用matplotlib绘制折线图(line chart)<strong>的方法。下面用</strong>Pygal</strong>来实现收盘价的<strong>折线图</strong>。</p>
<p>绘制折线图之前，需要<strong>获取x轴与y轴数据</strong>，因此我们<strong>创建了几个列表来存储数据</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 创建5个列表，分别存储日期和收盘价</span>
dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weeks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weekdays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
close <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 每一天的信息</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    months<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weeks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weekdays<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    close<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由于<strong>数据点比较多，x轴要显示346个日期，因此需要利用Pygal的配置参数，对图形进行适当的调整</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token keyword">import</span> pygal

line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span>x_label_rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> show_mirror_x_labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'收盘价（￥）'</span>
line_chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> dates
N <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment"># x轴坐标每隔20天显示一次</span>
line_chart<span class="token punctuation">.</span>x_labels_major <span class="token operator">=</span> dates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'收盘价'</span><span class="token punctuation">,</span> close<span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价折线图（￥）.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>pygal.Line()</code>创建Line实例<ul>
<li><code>x_label_rotation=20</code>：让x轴上的标签<strong>顺时针旋转20°</strong></li>
<li><code>show_mirror_x_labels=False</code>：告诉图形<strong>不用显示所有的x轴标签</strong></li>
</ul>
</li>
<li><code>line_chart.x_labels_major = dates[:20]</code>：x轴坐标<strong>每隔20天显示一次</strong></li>
</ul>
<p>下面<strong>对价格做一些简单的探索</strong></p>
<hr>
<h4 id="时间序列特征初探"><a href="#时间序列特征初探" class="headerlink" title="时间序列特征初探"></a>时间序列特征初探</h4><p>进行<strong>时间序列分析</strong>总是期望发现<strong>趋势(trend)</strong>、<strong>周期性(seasonality)<strong>和</strong>噪声(noise)</strong>，从而能够<strong>描述事实、预测未来、做出决策</strong>。</p>
<p>从收盘价的折线图可以看出，2017年的<strong>总体趋势</strong>时非线性的，而且增长幅度不断增大，似乎呈<strong>指数分布</strong>。但是，在<strong>每个季度末</strong>(3月、6月、9月)似乎<strong>有一些相似的波动</strong>，<strong>为了验证周期性的假设，需要先将非线性的趋势(指数增长部分)消除</strong>。**对数变换(log transformation)**是常用的处理方法之一。</p>
<p>用<strong>Python标准库的数学模块math</strong>来解决这个问题。math里有许多常用的数学函数，这里<strong>以10为底的对数函数math.log10计算收盘价</strong>，日期仍然保持不变——这种方式称为<strong>半对数(semi-logarithmic)变换</strong>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token keyword">import</span> pygal
<span class="token keyword">import</span> math

line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span>x_label_rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> show_mirror_x_labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'收盘价对数变换（￥）'</span>
line_chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> dates
N <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment"># x轴坐标每隔20天显示一次</span>
line_chart<span class="token punctuation">.</span>x_labels_major <span class="token operator">=</span> dates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
close_log <span class="token operator">=</span> <span class="token punctuation">[</span>math<span class="token punctuation">.</span>log10<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> close<span class="token punctuation">]</span>
line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'log收盘价'</span><span class="token punctuation">,</span> close_log<span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价对数变换折线图（￥）.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>剔除非线性趋势</strong>之后，<strong>整体的趋势更接近线性增长</strong>，且收盘价在每个季度末似乎有<strong>显著的周期性</strong>。那么，12月会不会再现这一场景？下面来看看收盘价的<strong>月日均值</strong>与<strong>周日均值</strong>的表现。</p>
<hr>
<h4 id="收盘价均值"><a href="#收盘价均值" class="headerlink" title="收盘价均值"></a>收盘价均值</h4><p>再利用btc_close_2017.json文件中的数据，绘制2017年<strong>前11个月</strong>的日均值、<strong>前49周(01-02~12-10)<strong>的日均值，以及</strong>每周各天</strong>的日均值。虽然这些日均值的数值不同，但都是一段时间的均值，计算方法都是一样的。因此，可以<strong>将绘图代码封装成函数</strong>，以便重复使用。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token keyword">from</span> itertools <span class="token keyword">import</span> groupby

<span class="token keyword">def</span> <span class="token function">draw_line</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">,</span> title<span class="token punctuation">,</span> y_legend<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xy_map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> groupby<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token keyword">_</span><span class="token punctuation">:</span> _<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_list <span class="token operator">=</span> <span class="token punctuation">[</span>v <span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> y<span class="token punctuation">]</span>
    xy_map<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x_unique<span class="token punctuation">,</span> y_mean <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>xy_map<span class="token punctuation">)</span><span class="token punctuation">]</span>
line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span><span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>title <span class="token operator">=</span> title
line_chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> x_unique
line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span>y_legend<span class="token punctuation">,</span> y_mean<span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span>title<span class="token operator">+</span><span class="token string">'.svg'</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> line_chart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>由于<strong>需要将数据按月份、周数、周几分组，再计算每组的均值</strong>，因此导入<strong>Python标准库中模块itertools的函数groupby</strong>。</li>
<li>将x轴与y轴的<strong>数据合并</strong>、<strong>排序</strong>，再<strong>用函数groupby分组</strong></li>
<li>分组之后，求出每组的平均值，存储到xy_map中</li>
<li>最后，将xy_map中存储的x轴与y轴数据分离，就可以像之前一样用Pygal画图了</li>
</ul>
<p>下面画出收盘价<strong>月日均值</strong>，由于12月的数据不完整，只取1月到11月的数据。<strong>通过dates查找2017-12-01索引的位置，确定周数和收盘价的取值范围</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">idx_month <span class="token operator">=</span> dates<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'2017-12-01'</span><span class="token punctuation">)</span>
line_chart_month <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>months<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价月日均值（￥）'</span><span class="token punctuation">,</span>
                            <span class="token string">'月日均值'</span><span class="token punctuation">)</span>
line_chart_month<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>





<hr>
<h4 id="收盘价数据仪表盘"><a href="#收盘价数据仪表盘" class="headerlink" title="收盘价数据仪表盘"></a>收盘价数据仪表盘</h4><p>每个SVG文件打开之后都是独立的页面，如果能<strong>整合</strong>在一起，就可以方便地进行<strong>长期管理、监测和分析</strong>。另外，<strong>新的图表也可以方便地加入进来</strong>，这样就形成了一个<strong>数据仪表盘</strong>(<strong>dashboard</strong>)。下面，将之前绘制的图整合起来，做一个收盘价数据仪表盘：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'收盘价Dashboard.html'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> html_file<span class="token punctuation">:</span>
    html_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>
        <span class="token string">'&lt;html>&lt;head>&lt;title>收盘价Dashboard&lt;/title>&lt;meta charset="utf-8">&lt;/head>&lt;body>\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> svg <span class="token keyword">in</span> <span class="token punctuation">[</span>
        <span class="token string">'收盘价折线图（¥）.svg'</span><span class="token punctuation">,</span> <span class="token string">'收盘价对数变换折线图（¥）.svg'</span><span class="token punctuation">,</span> <span class="token string">'收盘价月日均值（¥）.svg'</span><span class="token punctuation">,</span>
        <span class="token string">'收盘价周日均值（¥）.svg'</span><span class="token punctuation">,</span> <span class="token string">'收盘价星期均值（¥）.svg'</span>
    <span class="token punctuation">]</span><span class="token punctuation">:</span>
        html_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>
            <span class="token string">'    &lt;object type="image/svg+xml" data="&#123;0&#125;" height=500>&lt;/object>\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    html_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'&lt;/body>&lt;/html>'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和常见网络应用的数据仪表盘一样，这个数据仪表盘也是一个完整的网页。</p>
<hr>
<h2 id="使用-API"><a href="#使用-API" class="headerlink" title="使用 API"></a>使用 API</h2><h3 id="使用-Web-API"><a href="#使用-Web-API" class="headerlink" title="使用 Web API"></a>使用 Web API</h3><p>Web API是网站的一部分，用于 与使用非常具体的URL<strong>请求特定信息</strong>的程序 <strong>交互</strong>。这种请求称为<strong>API调用</strong>。请求的数据将<strong>以易于处理的格式(如JSON或CSV)返回</strong>。</p>
<p><strong>依赖于外部数据源</strong>的大多数应用程序都<strong>依赖于API调用</strong>，如集成社交媒体网站的应用程序。</p>
<h4 id="Git-和-GitHub"><a href="#Git-和-GitHub" class="headerlink" title="Git 和 GitHub"></a>Git 和 GitHub</h4><p>本章的可视化将基于来自GitHub的信息。我们将<strong>使用GitHub的API来请求有关该网站中Python项目的信息</strong>，然后<strong>使用Pygal生成交互式可视化，以呈现这些项目的受欢迎程度</strong>。</p>
<p>本章将编写一个程序，它<strong>自动下载GitHub上星级最高的Python项目的信息，并对这些信息进行可视化</strong>。</p>
<hr>
<h4 id="使用-API-调用请求数据"><a href="#使用-API-调用请求数据" class="headerlink" title="使用 API 调用请求数据"></a>使用 API 调用请求数据</h4><p>GitHub的API让你能够通过API调用来请求各种信息。要知道API调用是什么样的，在浏览器中访问如下地址：</p>
<pre class="line-numbers language-none"><code class="language-none">https:&#x2F;&#x2F;api.github.com&#x2F;search&#x2F;repositories?q&#x3D;language:python&amp;sort&#x3D;starshttps:&#x2F;&#x2F;api.github.com&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>第一部分<code>https://api.github.com/</code>：将请求发送到GitHub网站中响应API调用的部分</li>
<li>接下来的部分<code>search/repositories</code>：让API<strong>搜索GitHub上的所有仓库</strong></li>
<li>repositories后面的<strong>问号</strong>指出我们<strong>要传递一个实参</strong>。<ul>
<li><code>q=</code>：<strong>q</strong>表示<strong>查询</strong>，<strong>等号</strong>让我们能够开始<strong>指定查询</strong></li>
<li>通过使用<code>language:python</code>，我们指出<strong>只想获取主要语言为Python的仓库的信息</strong></li>
</ul>
</li>
<li>最后一部分<code>&amp;sort=stars</code>：指定将<strong>项目按其获得的星级排序</strong></li>
</ul>
<hr>
<h4 id="安装-requests"><a href="#安装-requests" class="headerlink" title="安装 requests"></a>安装 requests</h4><p><strong>requests包</strong>让Python程序能够<strong>轻松地向网站请求信息以及检查返回的响应</strong>。要安装requests，执行：</p>
<pre class="line-numbers language-none"><code class="language-none">pip install --user requests<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h4 id="处理-API-响应"><a href="#处理-API-响应" class="headerlink" title="处理 API 响应"></a>处理 API 响应</h4><p>下面来编写一个程序，它执行API调用并处理结果，找出GitHub上星级最高的Python项目：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">'https://api.github.com/search/repositories?=language:python&amp;sort=stars'</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Status code:"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>

<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 处理结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>使用<code>requests.get()</code>执行<strong>API调用</strong></p>
<p>  <strong>响应对象包含</strong>一个名为<code>status_code</code>的属性</p>
<ul>
<li>状态码<strong>200</strong>表示<strong>请求成功</strong></li>
</ul>
</li>
<li><p>这个API返回JSON格式的信息。因此我们<strong>使用方法<code>json()</code>将这些信息转换为一个Python字典</strong></p>
</li>
</ul>
<hr>
<h4 id="处理响应字典"><a href="#处理响应字典" class="headerlink" title="处理响应字典"></a>处理响应字典</h4><p>下面来生成一些概述API调用返回的信息的输出：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">'https://api.github.com/search/repositories?q=language:python&amp;sort=stars'</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Status code:"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>

<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Total repositories:"</span><span class="token punctuation">,</span> response_dict<span class="token punctuation">[</span><span class="token string">'total_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 探索有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Repositories returned:"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>repo_dicts<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 研究第一个仓库</span>
repo_dict <span class="token operator">=</span> repo_dicts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nKeys:"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>repo_dict<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> key <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>repo_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>与<code>&#39;items&#39;</code>关联的值是<strong>一个列表</strong>，其中包含很多字典，<strong>每个字典都包含有关一个Python仓库的信息</strong>。</li>
</ul>
<p>下面来提取repo_dict中与一些键相关联的值：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 研究第一个仓库</span>
repo_dict <span class="token operator">=</span> repo_dicts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nSelected information about first repository:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Name:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Owner:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'owner'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Stars:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Reposiory:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'html_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Created:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'created_at'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Updated:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'updated_at'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Description:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="概述最受欢迎的仓库"><a href="#概述最受欢迎的仓库" class="headerlink" title="概述最受欢迎的仓库"></a>概述最受欢迎的仓库</h4><p>对这些数据进行<strong>可视化</strong>时，我们需要<strong>涵盖多个仓库</strong>。下面就来编写一个循环，打印API调用返回的每个仓库的特定信息，以便能够在可视化中包含所有这些信息：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Repositories returned:"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>repo_dicts<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nSelected information about each repository:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nName:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Owner:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'owner'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Stars:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Reposiory:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'html_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Description:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="监视-API-的速率限制"><a href="#监视-API-的速率限制" class="headerlink" title="监视 API 的速率限制"></a>监视 API 的速率限制</h4><p>大多数API都存在<strong>速率限制</strong>，即你<strong>在特定时间内可执行的请求数存在限制</strong>。要获悉你是否接近了GitHub的限制，在浏览器中输入<code>https://api.github.com/rate_limit</code>，将得到类似于下面的响应：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"resources"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"core"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
            <span class="token property">"limit"</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token property">"remaining"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"reset"</span><span class="token operator">:</span><span class="token number">1593698255</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"graphql"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
            <span class="token property">"limit"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"remaining"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"reset"</span><span class="token operator">:</span><span class="token number">1593700880</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"integration_manifest"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
            <span class="token property">"limit"</span><span class="token operator">:</span><span class="token number">5000</span><span class="token punctuation">,</span>
            <span class="token property">"remaining"</span><span class="token operator">:</span><span class="token number">5000</span><span class="token punctuation">,</span>
            <span class="token property">"reset"</span><span class="token operator">:</span><span class="token number">1593700880</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"search"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
            <span class="token property">"limit"</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">"remaining"</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">"reset"</span><span class="token operator">:</span><span class="token number">1593697340</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"rate"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"limit"</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span>
        <span class="token property">"remaining"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"reset"</span><span class="token operator">:</span><span class="token number">1593698255</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们关心的信息是<strong>搜索API</strong>的速率限制。从18~22行可知，极限为<strong>每分钟</strong>10个请求；当前这一分钟内，还可执行10个请求；<code>reset</code>值指的是<strong>配额将重置的Unix时间或新纪元时间(1970-01-01午夜后多少秒)</strong>。用完配额后，将收到一条简单的响应，由此知道已到达API极限。<strong>到达极限后</strong>，<strong>必须等待配额重置</strong>。</p>
<p>注意：<strong>很多API都要求你注册获得密钥后才能执行API调用</strong>。GitHub没有这样的要求，但获得API密钥后，配额将高得多。</p>
<hr>
<h3 id="使用-Pygal-可视化仓库"><a href="#使用-Pygal-可视化仓库" class="headerlink" title="使用 Pygal 可视化仓库"></a>使用 Pygal 可视化仓库</h3><p>我们来进行可视化，<strong>呈现GitHub上Python项目的受欢迎程度</strong>。创建一个交互式条形图，<strong>条形的高度表示项目获得了多少颗星。单击条形将进入项目在GitHub上的主页</strong>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> pygal
<span class="token keyword">from</span> pygal<span class="token punctuation">.</span>style <span class="token keyword">import</span> LightColorizedStyle <span class="token keyword">as</span> LCS<span class="token punctuation">,</span> LightenStyle <span class="token keyword">as</span> LS

<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">'https://api.github.com/search/repositories?q=language:python&amp;sort=stars'</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Status code:"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>

<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Total repositories:"</span><span class="token punctuation">,</span> response_dict<span class="token punctuation">[</span><span class="token string">'total_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>

names<span class="token punctuation">,</span> stars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    stars<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
<span class="token comment"># 可视化</span>
my_style <span class="token operator">=</span> LS<span class="token punctuation">(</span><span class="token string">'#333366'</span><span class="token punctuation">,</span> base_style<span class="token operator">=</span>LCS<span class="token punctuation">)</span>
chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span>style<span class="token operator">=</span>my_style<span class="token punctuation">,</span> x_label_rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> show_legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Most-Starred Python Projects on GitHub'</span>
chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> names

chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> stars<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'python_repos.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>LS(&#39;#333366&#39;, base_style=LCS)</code>：使用<strong>LightenStyle</strong>(别名LS)<strong>定义了一种样式</strong>，并将<strong>基色设置为深蓝色</strong>；还传递了实参<code>base_style</code>，以<strong>使用LightColorizedStyle类</strong>(别名LCS)</li>
<li><code>show_legend=False</code>隐藏了图例，因为只在图表中绘制一个数据系列</li>
<li>由于<strong>不需要给这个数据系列添加标签</strong>，因此<strong>添加数据时，将标签设置成了空字符串</strong>。</li>
</ul>
<h4 id="改进-Pygal-图表"><a href="#改进-Pygal-图表" class="headerlink" title="改进 Pygal 图表"></a>改进 Pygal 图表</h4><p>我们将进行多个方面的定制，因此先来稍微调整代码结构，<strong>创建一个配置对象</strong>，其中包含要传递给<code>Bar()</code>的所有定制：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token comment"># 可视化</span>
my_style <span class="token operator">=</span> LS<span class="token punctuation">(</span><span class="token string">'#333366'</span><span class="token punctuation">,</span> base_style<span class="token operator">=</span>LCS<span class="token punctuation">)</span>

my_config <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Config<span class="token punctuation">(</span><span class="token punctuation">)</span>
my_config<span class="token punctuation">.</span>x_label_rotation <span class="token operator">=</span> <span class="token number">45</span>
my_config<span class="token punctuation">.</span>show_legend <span class="token operator">=</span> <span class="token boolean">False</span>
my_config<span class="token punctuation">.</span>title_font_size <span class="token operator">=</span> <span class="token number">24</span>
my_config<span class="token punctuation">.</span>label_font_size <span class="token operator">=</span> <span class="token number">14</span>
my_config<span class="token punctuation">.</span>major_label_font_size <span class="token operator">=</span> <span class="token number">18</span>
my_config<span class="token punctuation">.</span>truncate_label <span class="token operator">=</span> <span class="token number">15</span>
my_config<span class="token punctuation">.</span>show_y_guides <span class="token operator">=</span> <span class="token boolean">False</span>
my_config<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1000</span>

chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span>my_config<span class="token punctuation">,</span> style<span class="token operator">=</span>my_style<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Most-Starred Python Projects on GitHub'</span>
chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> names

chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> stars<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'python_repos.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>9~11行设置了图表标题、副标签和主标签的字体大小。</p>
<p>  在<strong>这个图表中</strong>，<strong>副标签</strong>是x轴上的项目名和y轴上的<strong>大部分</strong>数字；<strong>主标签</strong>是y轴上为<strong>5000整数倍的刻度</strong>，这些标签更大，以与副标签区分开。</p>
</li>
<li><p><code>truncate_label=15</code><strong>将较长的项目缩短</strong>为15个字符(将鼠标指向被截短的项目名，将显示完整的项目名)</p>
</li>
<li><p><code>show_y_guides=False</code>：<strong>隐藏图表中的水平线</strong>。</p>
</li>
<li><p><code>width=1000</code>：自定义的宽度，让图表更充分地利用浏览器中的可用空间</p>
</li>
</ul>
<hr>
<h4 id="添加自定义工具提示"><a href="#添加自定义工具提示" class="headerlink" title="添加自定义工具提示"></a>添加自定义工具提示</h4><p>在Python中，<strong>将鼠标指向条形将显示它表示的信息</strong>，这通常称为<strong>工具提示</strong>。下面来创建一个自定义工具提示，以同时显示项目的描述。</p>
<p>来看一个简单的示例，它可视化前三个项目，并给每个项目对应的条形都指定自定义标签。为此，我们向<code>add()</code><strong>传递一个字典列表</strong>，而不是值列表：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pygal
<span class="token keyword">from</span> pygal<span class="token punctuation">.</span>style <span class="token keyword">import</span> LightColorizedStyle <span class="token keyword">as</span> LCS<span class="token punctuation">,</span> LightenStyle <span class="token keyword">as</span> LS

my_style <span class="token operator">=</span> LS<span class="token punctuation">(</span><span class="token string">'#333366'</span><span class="token punctuation">,</span> base_style<span class="token operator">=</span>LCS<span class="token punctuation">)</span>
chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span>style<span class="token operator">=</span>my_style<span class="token punctuation">,</span> x_label_rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> show_legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Python Projects'</span>
chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'httpie'</span><span class="token punctuation">,</span> <span class="token string">'django'</span><span class="token punctuation">,</span> <span class="token string">'flask'</span><span class="token punctuation">]</span>

plot_dicts <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span><span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token number">16101</span>， <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'Description of httpie.'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span><span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token number">15028</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'Description of django.'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span><span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token number">14798</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'Description of flask.'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> plot_dicts<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'bar_descriptions.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>plot_dicts列表包含三个字典，<code>&#39;value&#39;</code>对应的值<strong>确定条形高度</strong>；<code>&#39;label&#39;</code>对应的值给条形<strong>创建工具提示</strong>。</li>
</ul>
<hr>
<h4 id="根据数据绘图"><a href="#根据数据绘图" class="headerlink" title="根据数据绘图"></a>根据数据绘图</h4><p>为根据数据绘图，我们将自动生成plot_dicts。其中包含API调用返回的30个项目的信息：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Number of items:"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>repo_dicts<span class="token punctuation">)</span><span class="token punctuation">)</span>

names<span class="token punctuation">,</span> plot_dicts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    plot_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'value'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'label'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    plot_dicts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>plot_dict<span class="token punctuation">)</span>
    
<span class="token comment"># 可视化</span>
my_style <span class="token operator">=</span> LS<span class="token punctuation">(</span><span class="token string">'#333366'</span><span class="token punctuation">,</span> base_style<span class="token operator">=</span>LCS<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> plot_dicts<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'python_repos.svg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="在图表中添加可单击的链接"><a href="#在图表中添加可单击的链接" class="headerlink" title="在图表中添加可单击的链接"></a>在图表中添加可单击的链接</h4><p>Pygal还允许<strong>将图表中的每个条形用作网站的链接</strong>。为此，在为每个项目创建的字典中，添加一个键为<code>&#39;xlink&#39;</code>的 键-值 对：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
names<span class="token punctuation">,</span> plot_dicts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    plot_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'value'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'label'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'xlink'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'html_url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    plot_dicts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>plot_dict<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>单击图表中的任何条形，都将在浏览器中打开一个新的标签页，并在其中显示相应项目的GitHub页面。</p>
<hr>
<h3 id="Hacker-News-API"><a href="#Hacker-News-API" class="headerlink" title="Hacker News API"></a>Hacker News API</h3><p><del>为探索如何使用其他网站的API调用，我们来看看</del></p>
<p><del>Hacker News网站，用户分享编程和技术方面的文章，并就这些文章展开积极的讨论。Hacker News的API让你能够访问有关该网站所有文章和评论的信息，且不要求通过注册获得密钥。</del></p>
<p>已被墙。</p>
<hr>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="Jupyter-Notebook-用matplotlib作图显示中文乱码"><a href="#Jupyter-Notebook-用matplotlib作图显示中文乱码" class="headerlink" title="Jupyter Notebook 用matplotlib作图显示中文乱码"></a>Jupyter Notebook 用matplotlib作图显示中文乱码</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>rc<span class="token punctuation">(</span><span class="token string">'font'</span><span class="token punctuation">,</span> family<span class="token operator">=</span><span class="token string">'SimHei'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>  <span class="token comment">##显示中文，字体大小根据需要调整</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h3 id="存在极端值干扰"><a href="#存在极端值干扰" class="headerlink" title="存在极端值干扰"></a>存在极端值干扰</h3><ul>
<li><p>使用<code>query()</code>做范围的筛选</p>
</li>
<li><p>根据<strong>切比雪夫定理</strong>做筛选：</p>
<ul>
<li>所有数据中，至少有75%的数据位于<strong>平均数</strong>2个<strong>标准差</strong>范围内</li>
</ul>
</li>
<li><p>所有数据中，至少有88.9%的数据位于平均数3个标准差范围内</p>
<ul>
<li>所有数据中，至少有96%的数据位于平均数5个标准差范围内</li>
</ul>
</li>
</ul>
<hr>
<h3 id="条形图和直方图的区别"><a href="#条形图和直方图的区别" class="headerlink" title="条形图和直方图的区别"></a>条形图和直方图的区别</h3><ul>
<li><p><strong>条形图</strong>(<strong>bar</strong> chart)</p>
<ol>
<li>用<strong>条形的高度</strong>表示<strong>各类别频数的多少</strong>，其<strong>宽度</strong>(<strong>表示类别</strong>)则是<strong>固定</strong>的；</li>
<li>条形图各矩形<strong>分开排列(有间隙)</strong></li>
<li>主要用于展示<strong>分类数据</strong></li>
</ol>
</li>
<li><p><strong>直方图</strong>(<strong>Histogram</strong>)</p>
<ol>
<li>用<strong>面积</strong>表示<strong>各组频数的多少</strong>，矩形的<strong>高度</strong>表示<strong>每一组的频数或频率</strong>，<strong>宽度</strong>则表示<strong>各组的组距</strong></li>
<li><strong>分组数据具有连续性</strong>，直方图各矩形通常是<strong>连续排列</strong></li>
<li>主要用于展示<strong>数值型数据</strong></li>
</ol>
</li>
</ul>
<hr>
<h3 id="绘图时x轴-y轴的刻度标签重叠"><a href="#绘图时x轴-y轴的刻度标签重叠" class="headerlink" title="绘图时x轴&#x2F;y轴的刻度标签重叠"></a>绘图时x轴&#x2F;y轴的刻度标签重叠</h3><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1441795">Matplotlib绘图时x轴标签重叠的解决办法 - 云+社区 - 腾讯云</a></p>
<ul>
<li><p>方法一：</p>
<p>  拉长画布</p>
</li>
<li><p>方法二：</p>
<p>  调整刻度标签的字体大小：<code>plt.tick_params(axis=&#39;x&#39;, labelsize=8)</code></p>
</li>
<li><p>方法三：</p>
<p>  将纵向图改为横向，如条形图：<code>plt.barh()</code></p>
</li>
<li><p><strong>方法四</strong>：</p>
<p>  <strong>旋转刻度标签的角度</strong>：<code>plt.xticks(rotation=30)</code></p>
</li>
</ul>
<hr>
<h2 id="Pandas常用图表简介"><a href="#Pandas常用图表简介" class="headerlink" title="Pandas常用图表简介"></a><a target="_blank" rel="noopener" href="https://www.kesci.com/home/project/5dc00c36080dc300371f867e">Pandas常用图表简介</a></h2><h3 id="箱线图-箱型图-盒型图"><a href="#箱线图-箱型图-盒型图" class="headerlink" title="箱线图(箱型图&#x2F;盒型图)"></a>箱线图(箱型图&#x2F;盒型图)</h3><p><strong>直方图</strong>用于显示一组数据的<strong>分布情况</strong>，而<strong>箱线图</strong>用于显示一组数据<strong>内部的分散情况</strong>。例如： <strong>最大值、最小值，中位数，4分位数、异常值</strong>等等。</p>
<ul>
<li><p>箱线图各部位的含义</p>
<p>  <img src="https://i.loli.net/2020/08/23/sQpFl2vnWYNZ4x7.png" alt="箱线图各部位的含义"></p>
<ul>
<li><p><strong>上四分位</strong>数(Q<strong>U</strong>)：第75%位数</p>
</li>
<li><p><strong>下四分位</strong>数(Q<strong>L</strong>)：第25%位数</p>
</li>
<li><p>异常值的标准：</p>
<ul>
<li><p><strong>IQR</strong>(Inter-Quatile range)：<strong>四分位距</strong></p>
<p>  <strong>IQR &#x3D; QU - QL</strong>，<strong>IQR包含了全部观察值的一半</strong></p>
</li>
<li><p><strong>过小</strong>的异常值为 $&lt;$ <strong>QL-1.5IQR</strong>的值</p>
</li>
<li><p><strong>过大</strong>的异常值 $&gt;$ <strong>QU+1.5IQR</strong>的值</p>
</li>
</ul>
</li>
</ul>
<p>  Matplotlib中绘制箱线图的函数为<code>DataFrame.boxplot()</code></p>
</li>
</ul>
<hr>
<h2 id="一文学会matplotlib绘图"><a href="#一文学会matplotlib绘图" class="headerlink" title="一文学会matplotlib绘图"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/985bc26672ce">一文学会matplotlib绘图</a></h2>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
              <a href="/tags/matplotlib/" rel="tag"><i class="fa fa-tag"></i> matplotlib</a>
              <a href="/tags/svg/" rel="tag"><i class="fa fa-tag"></i> svg</a>
              <a href="/tags/CSV/" rel="tag"><i class="fa fa-tag"></i> CSV</a>
              <a href="/tags/pyplot/" rel="tag"><i class="fa fa-tag"></i> pyplot</a>
              <a href="/tags/pygal/" rel="tag"><i class="fa fa-tag"></i> pygal</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/06/17/Navicat%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" rel="prev" title="Navicat使用技巧">
                  <i class="fa fa-angle-left"></i> Navicat使用技巧
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/07/03/Python%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0%E9%A2%98/" rel="next" title="Python基础练习题">
                  Python基础练习题 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hunter</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Hunter1023/Hunter1023.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
