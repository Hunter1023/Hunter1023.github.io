<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hunter1023.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":3,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="练习一准备数据建表语句CREATE TABLE students (sno VARCHAR(3) NOT NULL,  sname VARCHAR(4) NOT NULL, ssex VARCHAR(2) NOT NULL,  sbirthday DATETIME, class VARCHAR(5));  CREATE TABLE courses (cno VARCHAR(5) NOT NULL,">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL练习题">
<meta property="og:url" content="https://hunter1023.github.io/2020/06/17/SQL%E7%BB%83%E4%B9%A0%E9%A2%98/index.html">
<meta property="og:site_name" content="Talk is cheap">
<meta property="og:description" content="练习一准备数据建表语句CREATE TABLE students (sno VARCHAR(3) NOT NULL,  sname VARCHAR(4) NOT NULL, ssex VARCHAR(2) NOT NULL,  sbirthday DATETIME, class VARCHAR(5));  CREATE TABLE courses (cno VARCHAR(5) NOT NULL,">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/09/13/2pa43QDgf8wzReU.png">
<meta property="article:published_time" content="2020-06-17T06:25:35.000Z">
<meta property="article:modified_time" content="2025-01-23T15:29:13.000Z">
<meta property="article:author" content="Hunter">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/09/13/2pa43QDgf8wzReU.png">


<link rel="canonical" href="https://hunter1023.github.io/2020/06/17/SQL%E7%BB%83%E4%B9%A0%E9%A2%98/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hunter1023.github.io/2020/06/17/SQL%E7%BB%83%E4%B9%A0%E9%A2%98/","path":"2020/06/17/SQL练习题/","title":"SQL练习题"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SQL练习题 | Talk is cheap</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Talk is cheap</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80"><span class="nav-number">1.</span> <span class="nav-text">练习一</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.</span> <span class="nav-text">准备数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.1.1.</span> <span class="nav-text">建表语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.2.</span> <span class="nav-text">插入数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E9%A2%98"><span class="nav-number">1.2.</span> <span class="nav-text">练习题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%8C"><span class="nav-number">2.</span> <span class="nav-text">练习二</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-1"><span class="nav-number">2.1.</span> <span class="nav-text">准备数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5-1"><span class="nav-number">2.1.1.</span> <span class="nav-text">建表语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.2.</span> <span class="nav-text">导入数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E9%A2%98-1"><span class="nav-number">2.2.</span> <span class="nav-text">练习题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%89"><span class="nav-number">3.</span> <span class="nav-text">练习三</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-2"><span class="nav-number">3.1.</span> <span class="nav-text">准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">3.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E7%AD%94"><span class="nav-number">3.3.</span> <span class="nav-text">解答</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Leetcode-%E4%B8%8A%E7%9A%84SQL%E9%A2%98"><span class="nav-number">4.</span> <span class="nav-text">Leetcode 上的SQL题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%9B%E5%AE%A2%E7%BD%91%E4%B8%8A%E7%9A%84SQL%E9%A2%98"><span class="nav-number">5.</span> <span class="nav-text">牛客网上的SQL题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%AF%E8%AE%A1%E7%94%A8%E6%88%B7%E6%95%B0%E8%AE%A1%E7%AE%97"><span class="nav-number">6.</span> <span class="nav-text">累计用户数计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E7%BB%AD%E8%AE%BF%E9%97%AE%E5%A4%A9%E6%95%B0"><span class="nav-number">7.</span> <span class="nav-text">连续访问天数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E7%94%A8%E6%88%B7%E7%9A%84%E8%BF%917%E6%97%A5%E7%95%99%E5%AD%98%E7%8E%87"><span class="nav-number">8.</span> <span class="nav-text">新增用户的近7日留存率</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%97%A5%E6%B4%BB%E7%94%A8%E6%88%B7%E7%AD%BE%E5%88%B0%EF%BC%8C%E5%BC%80%E5%AE%9D%E7%AE%B1%EF%BC%8C%E9%98%85%E8%AF%BB%E8%A1%8C%E4%B8%BA%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%84%E8%87%AA%E5%8D%A0%E6%AF%94"><span class="nav-number">9.</span> <span class="nav-text">计算日活用户签到，开宝箱，阅读行为的用户各自占比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E5%9B%9B"><span class="nav-number">10.</span> <span class="nav-text">练习四</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-3"><span class="nav-number">10.1.</span> <span class="nav-text">准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E9%A2%98-2"><span class="nav-number">10.2.</span> <span class="nav-text">练习题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-4"><span class="nav-number">10.3.</span> <span class="nav-text">准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E9%A2%98-3"><span class="nav-number">10.4.</span> <span class="nav-text">练习题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-5"><span class="nav-number">10.5.</span> <span class="nav-text">准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-6"><span class="nav-number">10.6.</span> <span class="nav-text">准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-7"><span class="nav-number">10.7.</span> <span class="nav-text">准备数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE-8"><span class="nav-number">10.8.</span> <span class="nav-text">准备数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%94"><span class="nav-number">11.</span> <span class="nav-text">练习五</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%91%E6%88%98%E9%A2%98"><span class="nav-number">11.1.</span> <span class="nav-text">挑战题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PDD%E7%AC%94%E8%AF%95%E9%A2%98"><span class="nav-number">12.</span> <span class="nav-text">PDD笔试题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90"><span class="nav-number">12.1.</span> <span class="nav-text">2. 用户行为分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%94%A8%E6%88%B7%E6%96%B0%E5%A2%9E%E7%95%99%E5%AD%98%E5%88%86%E6%9E%90"><span class="nav-number">12.2.</span> <span class="nav-text">3. 用户新增留存分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%85%AC%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">12.3.</span> <span class="nav-text">4. 贝叶斯公式的应用</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Hunter</p>
  <div class="site-description" itemprop="description">Tough times never last, but tough people do.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">175</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hunter1023.github.io/2020/06/17/SQL%E7%BB%83%E4%B9%A0%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Hunter">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Talk is cheap">
      <meta itemprop="description" content="Tough times never last, but tough people do.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SQL练习题 | Talk is cheap">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQL练习题<a href="https://github.com/Hunter1023/hexo_blog/edit/gh-pages/source/_posts/SQL%E7%BB%83%E4%B9%A0%E9%A2%98.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-17 14:25:35" itemprop="dateCreated datePublished" datetime="2020-06-17T14:25:35+08:00">2020-06-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-23 23:29:13" itemprop="dateModified" datetime="2025-01-23T23:29:13+08:00">2025-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="练习一"><a href="#练习一" class="headerlink" title="练习一"></a>练习一</h2><h3 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h3><h4 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> students
<span class="token punctuation">(</span>sno <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
sname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
ssex <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
sbirthday <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
class <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> courses
<span class="token punctuation">(</span>cno <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
cname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
tno <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> scores
<span class="token punctuation">(</span>sno <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
cno <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
degree <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> teachers 
<span class="token punctuation">(</span>tno <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
tname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> tsex <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
tbirthday <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> prof <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
depart <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbrithday<span class="token punctuation">,</span> class<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">108</span> <span class="token punctuation">,</span><span class="token string">'曾华'</span> <span class="token punctuation">,</span><span class="token string">'男'</span> <span class="token punctuation">,</span><span class="token string">'1977-09-01'</span><span class="token punctuation">,</span><span class="token number">95033</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbrithday<span class="token punctuation">,</span> class<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">105</span> <span class="token punctuation">,</span><span class="token string">'匡明'</span> <span class="token punctuation">,</span><span class="token string">'男'</span> <span class="token punctuation">,</span><span class="token string">'1975-10-02'</span><span class="token punctuation">,</span><span class="token number">95031</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbrithday<span class="token punctuation">,</span> class<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">107</span> <span class="token punctuation">,</span><span class="token string">'王丽'</span> <span class="token punctuation">,</span><span class="token string">'女'</span> <span class="token punctuation">,</span><span class="token string">'1976-01-23'</span><span class="token punctuation">,</span><span class="token number">95033</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbrithday<span class="token punctuation">,</span> classS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">101</span> <span class="token punctuation">,</span><span class="token string">'李军'</span> <span class="token punctuation">,</span><span class="token string">'男'</span> <span class="token punctuation">,</span><span class="token string">'1976-02-20'</span><span class="token punctuation">,</span><span class="token number">95033</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbrithday<span class="token punctuation">,</span> class<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">109</span> <span class="token punctuation">,</span><span class="token string">'王芳'</span> <span class="token punctuation">,</span><span class="token string">'女'</span> <span class="token punctuation">,</span><span class="token string">'1975-02-10'</span><span class="token punctuation">,</span><span class="token number">95031</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> sbrithday<span class="token punctuation">,</span> class<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">103</span> <span class="token punctuation">,</span><span class="token string">'陆君'</span> <span class="token punctuation">,</span><span class="token string">'男'</span> <span class="token punctuation">,</span><span class="token string">'1974-06-03'</span><span class="token punctuation">,</span><span class="token number">95031</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> COURSES<span class="token punctuation">(</span>cno<span class="token punctuation">,</span> cname<span class="token punctuation">,</span> tno<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'3-105'</span> <span class="token punctuation">,</span><span class="token string">'计算机导论'</span><span class="token punctuation">,</span><span class="token number">825</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> COURSES<span class="token punctuation">(</span>cno<span class="token punctuation">,</span> cname<span class="token punctuation">,</span> tno<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'3-245'</span> <span class="token punctuation">,</span><span class="token string">'操作系统'</span> <span class="token punctuation">,</span><span class="token number">804</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> COURSES<span class="token punctuation">(</span>cno<span class="token punctuation">,</span> cname<span class="token punctuation">,</span> tno<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'6-166'</span> <span class="token punctuation">,</span><span class="token string">'数据电路'</span> <span class="token punctuation">,</span><span class="token number">856</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> COURSES<span class="token punctuation">(</span>cno<span class="token punctuation">,</span> cname<span class="token punctuation">,</span> tno<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'9-888'</span> <span class="token punctuation">,</span><span class="token string">'高等数学'</span> <span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token string">'3-245'</span><span class="token punctuation">,</span><span class="token number">86</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token string">'3-245'</span><span class="token punctuation">,</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token string">'3-245'</span><span class="token punctuation">,</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token string">'3-105'</span><span class="token punctuation">,</span><span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token string">'3-105'</span><span class="token punctuation">,</span><span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token string">'3-105'</span><span class="token punctuation">,</span><span class="token number">76</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'3-105'</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token string">'3-105'</span><span class="token punctuation">,</span><span class="token number">91</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token string">'3-105'</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'6-166'</span><span class="token punctuation">,</span><span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token string">'6-166'</span><span class="token punctuation">,</span><span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORES<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token string">'6-166'</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TEACHERS<span class="token punctuation">(</span>tno<span class="token punctuation">,</span> tname<span class="token punctuation">,</span> tsex<span class="token punctuation">,</span> tbirthday<span class="token punctuation">,</span> prof<span class="token punctuation">,</span> depart<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">804</span><span class="token punctuation">,</span><span class="token string">'李诚'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'1958-12-02'</span><span class="token punctuation">,</span><span class="token string">'副教授'</span><span class="token punctuation">,</span><span class="token string">'计算机系'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TEACHERS<span class="token punctuation">(</span>tno<span class="token punctuation">,</span> tname<span class="token punctuation">,</span> tsex<span class="token punctuation">,</span> tbirthday<span class="token punctuation">,</span> prof<span class="token punctuation">,</span> depart<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">856</span><span class="token punctuation">,</span><span class="token string">'张旭'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'1969-03-12'</span><span class="token punctuation">,</span><span class="token string">'讲师'</span><span class="token punctuation">,</span><span class="token string">'电子工程系'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TEACHERS<span class="token punctuation">(</span>tno<span class="token punctuation">,</span> tname<span class="token punctuation">,</span> tsex<span class="token punctuation">,</span> tbirthday<span class="token punctuation">,</span> prof<span class="token punctuation">,</span> depart<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">825</span><span class="token punctuation">,</span><span class="token string">'王萍'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'1972-05-05'</span><span class="token punctuation">,</span><span class="token string">'助教'</span><span class="token punctuation">,</span><span class="token string">'计算机系'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TEACHERS<span class="token punctuation">(</span>tno<span class="token punctuation">,</span> tname<span class="token punctuation">,</span> tsex<span class="token punctuation">,</span> tbirthday<span class="token punctuation">,</span> prof<span class="token punctuation">,</span> depart<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">831</span><span class="token punctuation">,</span><span class="token string">'刘冰'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'1977-08-14'</span><span class="token punctuation">,</span><span class="token string">'助教'</span><span class="token punctuation">,</span><span class="token string">'电子工程系'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h3><ol>
<li><p>查询student表中的所有记录的sname、ssex和class列。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sname<span class="token punctuation">,</span> ssex<span class="token punctuation">,</span> class
<span class="token keyword">FROM</span> students<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>查询教师所有的单位，即<strong>不重复</strong>的depart列。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> depart
<span class="token keyword">FROM</span> teachers<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>查询students表的<strong>所有</strong>记录。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> students<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>查询scores表中<strong>成绩在60到80之间</strong>的所有记录。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 方法一</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> degree <span class="token operator">>=</span> <span class="token number">60</span> <span class="token operator">AND</span> degree <span class="token operator">&lt;=</span> <span class="token number">80</span><span class="token punctuation">;</span>

<span class="token comment"># 方法二</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> degree <span class="token operator">BETWEEN</span> <span class="token number">60</span> <span class="token operator">AND</span> <span class="token number">80</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★查询scores表中<strong>成绩为85，86或88的记录</strong>。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 方法一</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> degree <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 方法二</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> degree <span class="token operator">=</span> <span class="token number">85</span> <span class="token operator">OR</span> degree <span class="token operator">=</span> <span class="token number">86</span> <span class="token operator">OR</span> degree <span class="token operator">=</span> <span class="token number">88</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询students表中**“95031”班<strong>或</strong>性别为“女”**的同学记录。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> students
<span class="token keyword">WHERE</span> class <span class="token operator">=</span> <span class="token string">'95031'</span> <span class="token operator">OR</span> ssex <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>以<strong>class降序</strong>查询students表的所有记录。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> students
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> class <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★以<strong>cno升序</strong>、<strong>degree降序</strong>查询scores表的所有记录。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> scores
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> con<span class="token punctuation">,</span> degree <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询student表中“95031”班的学生<strong>人数</strong>。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> stu_num
<span class="token keyword">FROM</span> students
<span class="token keyword">WHERE</span> class <span class="token operator">=</span> <span class="token string">'95031'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询<strong>scores</strong>表中的<strong>最高分</strong>的学生学号和课程号。</p>
<p>解答：<strong>子查询</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sno<span class="token punctuation">,</span> cno
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> degree <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span>
                <span class="token keyword">FROM</span> scores<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★查询scores表中‘3-105’号课程的<strong>平均分</strong>。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> cno <span class="token operator">=</span> <span class="token string">'3-105'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询scores表中<strong>至少有5名学生选修</strong>的并<strong>以3开头的课程</strong>的<strong>平均分数</strong>。</p>
<p>解答：<strong>分组</strong>（<strong>HAVING子句</strong>用于过滤分组）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 方法一</span>
<span class="token keyword">SELECT</span> cno<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_degree
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> cno <span class="token operator">LIKE</span> <span class="token string">'3%'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cno
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment"># 方法二</span>
<span class="token keyword">SELECT</span> cno<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_degree
<span class="token keyword">FROM</span> scores
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cno
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span> <span class="token operator">AND</span> cno <span class="token operator">LIKE</span> <span class="token string">'3%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询scores表中<strong>最低分大于70</strong>，<strong>最高分小于90</strong>的sno列。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sno
<span class="token keyword">FROM</span> scores
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sno
<span class="token keyword">HAVING</span> <span class="token function">MIN</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">70</span> <span class="token operator">AND</span> <span class="token function">MAX</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">90</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★查询所有学生的sname、cno和degree列。</p>
<p>解答：</p>
<ul>
<li><strong>外部</strong>联结(OUTER JOIN, <strong>OUTER可省略</strong>)</li>
<li><strong>内部</strong>联结(INNER JOIN)</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 方法一：外部联结, LEFT JOIN 左边的表 所有记录都会列出</span>
<span class="token keyword">SELECT</span> stu<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> sco<span class="token punctuation">.</span>cno<span class="token punctuation">,</span> sco<span class="token punctuation">.</span>degree
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> stu <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> scores <span class="token keyword">AS</span> sco
<span class="token keyword">ON</span> stu<span class="token punctuation">.</span>sno <span class="token operator">=</span> sco<span class="token punctuation">.</span>sno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sname<span class="token punctuation">;</span>

<span class="token comment"># 方法二：内部联结， INNER JOIN 只返回两个表中联结字段相等的行</span>
<span class="token keyword">SELECT</span> stu<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> sco<span class="token punctuation">.</span>cno<span class="token punctuation">,</span> sco<span class="token punctuation">.</span>degree
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> stu <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> scores <span class="token keyword">AS</span> sco
<span class="token keyword">ON</span> stu<span class="token punctuation">.</span>sno <span class="token operator">=</span> sco<span class="token punctuation">.</span>sno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sname<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★查询所有学生的sno、cname和degree列。</p>
<p>解答：外部联结</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> s<span class="token punctuation">.</span>sno<span class="token punctuation">,</span> c<span class="token punctuation">.</span>cname<span class="token punctuation">,</span> s<span class="token punctuation">.</span>degree
<span class="token keyword">FROM</span> scores <span class="token keyword">AS</span> s
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> courses <span class="token keyword">AS</span> c <span class="token keyword">ON</span> s<span class="token punctuation">.</span>cno <span class="token operator">=</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sno<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询所有学生的sname、cname和degree列。</p>
<p>解答：外部联结</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> st<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> c<span class="token punctuation">.</span>cname<span class="token punctuation">,</span> sc<span class="token punctuation">.</span>degree
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> st 
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> scores <span class="token keyword">AS</span> sc <span class="token keyword">ON</span> st<span class="token punctuation">.</span>sno <span class="token operator">=</span> sc<span class="token punctuation">.</span>sno
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> courses <span class="token keyword">AS</span> c <span class="token keyword">ON</span> sc<span class="token punctuation">.</span>cno <span class="token operator">=</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sname<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询“95033”班<strong>所选课程</strong>的平均分。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cname<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> st
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> scores <span class="token keyword">AS</span> sc <span class="token keyword">ON</span> st<span class="token punctuation">.</span>sno <span class="token operator">=</span> sc<span class="token punctuation">.</span>sno
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> courses <span class="token keyword">AS</span> c <span class="token keyword">ON</span> sc<span class="token punctuation">.</span>cno <span class="token operator">=</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">WHERE</span> class <span class="token operator">=</span> <span class="token string">'95033'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cname<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★假设使用如下命令建立了一个grade表：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> grade<span class="token punctuation">(</span>low <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> upp <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rank <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> grade <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> grade <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">89</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> grade <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> grade <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">69</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> grade <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>现查询所有同学的sno、cno和rank列。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> rank
<span class="token keyword">FROM</span> scores <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> grade
<span class="token keyword">ON</span> scores<span class="token punctuation">.</span>degree <span class="token operator">BETWEEN</span> grade<span class="token punctuation">.</span>low <span class="token operator">AND</span> grade<span class="token punctuation">.</span>upp
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sno<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询<strong>选修“3-105”课程</strong>的<strong>成绩高于“109”号同学成绩</strong>的所有同学的记录。</p>
<p>解答：</p>
<ul>
<li><strong>自联结</strong></li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sname<span class="token punctuation">,</span> s1<span class="token punctuation">.</span>degree
<span class="token keyword">FROM</span> scores <span class="token keyword">AS</span> s1
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> scores <span class="token keyword">AS</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>cno <span class="token operator">=</span> s2<span class="token punctuation">.</span>cno <span class="token operator">AND</span>  s1<span class="token punctuation">.</span>degree <span class="token operator">></span> s2<span class="token punctuation">.</span>degree
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> students <span class="token keyword">AS</span> st <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>sno <span class="token operator">=</span> st<span class="token punctuation">.</span>sno
<span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>cno <span class="token operator">=</span> <span class="token string">'3-105'</span> <span class="token operator">AND</span> s2<span class="token punctuation">.</span>sno <span class="token operator">=</span> <span class="token string">'109'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> s1<span class="token punctuation">.</span>degree<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询scores中<strong>选学一门以上课程</strong>的同学中分数为<strong>非最高分成绩</strong>的记录。</p>
<p>解答：</p>
<ul>
<li>条件：<ol>
<li>选学一门以上课程</li>
<li>列出这些同学的所有非最高分成绩</li>
</ol>
</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> scores<span class="token punctuation">.</span>sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree<span class="token punctuation">,</span> max_degree
<span class="token keyword">FROM</span> scores <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 
			<span class="token punctuation">(</span><span class="token keyword">SELECT</span> sno<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token keyword">AS</span> max_degree 
             <span class="token keyword">FROM</span> scores 
             <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sno 
             <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> max 
<span class="token keyword">ON</span> scores<span class="token punctuation">.</span>sno <span class="token operator">=</span> max<span class="token punctuation">.</span>sno <span class="token operator">AND</span> degree <span class="token operator">&lt;</span> max_degree
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sno<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询成绩高于<strong>学号为“109”、课程号为“3-105”的成绩</strong>的所有记录。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> st<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> s1<span class="token punctuation">.</span>cno<span class="token punctuation">,</span> s1<span class="token punctuation">.</span>degree
<span class="token keyword">FROM</span> scores <span class="token keyword">AS</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> scores <span class="token keyword">AS</span> s2
<span class="token keyword">ON</span> s1<span class="token punctuation">.</span>cno <span class="token operator">=</span> s2<span class="token punctuation">.</span>cno <span class="token operator">AND</span> s1<span class="token punctuation">.</span>degree <span class="token operator">></span> s2<span class="token punctuation">.</span>degree
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> students <span class="token keyword">AS</span> st
<span class="token keyword">ON</span> s1<span class="token punctuation">.</span>sno <span class="token operator">=</span> st<span class="token punctuation">.</span>sno
<span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>cno <span class="token operator">=</span> <span class="token string">'3-105'</span> <span class="token operator">AND</span> s2<span class="token punctuation">.</span>sno <span class="token operator">=</span> <span class="token string">'109'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> s1<span class="token punctuation">.</span>degree<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询和学号为108的同学<strong>同年出生</strong>的所有学生的sno、sname和sbirthday列。</p>
<p>解答：函数<code>YEAR(d)</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span>sno<span class="token punctuation">,</span> s1<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> s1<span class="token punctuation">.</span>sbirthday
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> students <span class="token keyword">AS</span> s2
<span class="token keyword">ON</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>sbirthday<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span>sbirthday<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>sno <span class="token operator">=</span> <span class="token string">'108'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sbirthday<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询“张旭“教师任课的学生成绩。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sno<span class="token punctuation">,</span> degree
<span class="token keyword">FROM</span> scores <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> courses
<span class="token keyword">ON</span> scores<span class="token punctuation">.</span>cno <span class="token operator">=</span> courses<span class="token punctuation">.</span>cno
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> teachers
<span class="token keyword">ON</span> courses<span class="token punctuation">.</span>tno <span class="token operator">=</span> teachers<span class="token punctuation">.</span>tno
<span class="token keyword">WHERE</span> teachers<span class="token punctuation">.</span>tname <span class="token operator">=</span> <span class="token string">'张旭'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> degree<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询选修某课程的同学人数<strong>多于5人</strong>的<strong>教师姓名</strong>。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tname
<span class="token keyword">FROM</span> scores <span class="token keyword">AS</span> s <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> courses <span class="token keyword">AS</span> c
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>cno <span class="token operator">=</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> teachers <span class="token keyword">AS</span> t
<span class="token keyword">ON</span> t<span class="token punctuation">.</span>tno <span class="token operator">=</span> c<span class="token punctuation">.</span>tno
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>cno<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询95033班和95031班<strong>全体学生的记录</strong>。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> students
<span class="token keyword">WHERE</span> class <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'95033'</span><span class="token punctuation">,</span> <span class="token string">'95031'</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> class<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询<strong>有85分以上成绩</strong>的课程cno。</p>
<p>解答：<strong>DISTINCT</strong>关键字</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> degree <span class="token operator">></span> <span class="token number">85</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询出“计算机系“教师所教课程的成绩表。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>tname<span class="token punctuation">,</span> s<span class="token punctuation">.</span>cno<span class="token punctuation">,</span> cname<span class="token punctuation">,</span> sno<span class="token punctuation">,</span> degree
<span class="token keyword">FROM</span> scores <span class="token keyword">AS</span> s <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> courses <span class="token keyword">AS</span> c
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>cno <span class="token operator">=</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> teachers <span class="token keyword">AS</span> t
<span class="token keyword">ON</span> t<span class="token punctuation">.</span>tno <span class="token operator">=</span> c<span class="token punctuation">.</span>tno
<span class="token keyword">WHERE</span> t<span class="token punctuation">.</span>depart <span class="token operator">=</span> <span class="token string">'计算机系'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t<span class="token punctuation">.</span>tname<span class="token punctuation">,</span> cname<span class="token punctuation">,</span> degree <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询“计算机系”中与“电子工程系“的教师<strong>不同职称</strong>教师的tname和prof。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tname<span class="token punctuation">,</span> prof
<span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> depart <span class="token operator">=</span> <span class="token string">'计算机系'</span> <span class="token operator">AND</span> prof <span class="token operator">NOT</span> <span class="token operator">IN</span> 
								<span class="token punctuation">(</span><span class="token keyword">SELECT</span> prof
                                <span class="token keyword">FROM</span> teachers
                                <span class="token keyword">WHERE</span> depart <span class="token operator">=</span> <span class="token string">'电子工程系'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询选修编号为“3-105”课程且成绩至少<strong>高于任意</strong>选修编号为“3-245”的同学的成绩的cno、sno和degree。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cno<span class="token punctuation">,</span> sno<span class="token punctuation">,</span> degree
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> cno <span class="token operator">=</span> <span class="token string">'3-105'</span> <span class="token operator">AND</span> degree <span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span>
    							<span class="token keyword">FROM</span> scores
    							<span class="token keyword">WHERE</span> cno <span class="token operator">=</span> <span class="token string">'3-245'</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> degree <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询选修编号为”3-105“且成绩<strong>高于所有</strong>选修编号为”3-245“课程的同学的cno、sno和degree。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cno<span class="token punctuation">,</span> sno<span class="token punctuation">,</span> degree
<span class="token keyword">FROM</span> scores
<span class="token keyword">WHERE</span> cno <span class="token operator">=</span> <span class="token string">'3-105'</span> <span class="token operator">AND</span> degree <span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span>
    							<span class="token keyword">FROM</span> scores
    							<span class="token keyword">WHERE</span> cno <span class="token operator">=</span> <span class="token string">'3-245'</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> degree <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询<strong>所有教师和同学</strong>的name、sex和birthday。</p>
<p>解答：<strong>组合查询UNION</strong></p>
<ul>
<li>UNION中<strong>每个查询必须包含相同的列、表达式或聚集函数</strong>（不过各个列<strong>不需要以相同的次序列出</strong>）。</li>
<li>列数据类型必须<strong>兼容</strong>。类型不必完全相同，但必须是DBMS可以隐含地转换的类型(如<strong>不同的数值类型</strong>或<strong>不同的日期类型</strong>)。</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tname <span class="token keyword">AS</span> name<span class="token punctuation">,</span> tsex <span class="token keyword">AS</span> sex<span class="token punctuation">,</span> tbirthday <span class="token keyword">AS</span> birthday
<span class="token keyword">FROM</span> teachers
<span class="token keyword">UNION</span> 
<span class="token keyword">SELECT</span> sname <span class="token keyword">AS</span> name<span class="token punctuation">,</span> ssex <span class="token keyword">AS</span> sex<span class="token punctuation">,</span> sbirthday <span class="token keyword">AS</span> birthday
<span class="token keyword">FROM</span> students
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> birthday<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询所有“女”教师和“女”同学的name、sex和birthday。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tname <span class="token keyword">AS</span> name<span class="token punctuation">,</span> tsex <span class="token keyword">AS</span> sex<span class="token punctuation">,</span> tbirthday <span class="token keyword">AS</span> birthday
<span class="token keyword">FROM</span> teachers <span class="token keyword">AS</span> t
<span class="token keyword">WHERE</span> t<span class="token punctuation">.</span>tsex <span class="token operator">=</span> <span class="token string">'女'</span>
<span class="token keyword">UNION</span> 
<span class="token keyword">SELECT</span> sname <span class="token keyword">AS</span> name<span class="token punctuation">,</span> ssex <span class="token keyword">AS</span> sex<span class="token punctuation">,</span> sbirthday <span class="token keyword">AS</span> birthday
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> s
<span class="token keyword">WHERE</span> s<span class="token punctuation">.</span>ssex <span class="token operator">=</span> <span class="token string">'女'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> birthday<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★★查询成绩<strong>比该课程平均成绩低</strong>的同学的成绩表。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> avg_degree
<span class="token keyword">FROM</span> scores <span class="token keyword">AS</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> cno<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_degree
	<span class="token keyword">FROM</span> scores
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cno<span class="token punctuation">)</span> <span class="token keyword">AS</span> s2
<span class="token keyword">ON</span> s1<span class="token punctuation">.</span>cno <span class="token operator">=</span> s2<span class="token punctuation">.</span>cno <span class="token operator">AND</span> s1<span class="token punctuation">.</span>degree <span class="token operator">&lt;</span> s2<span class="token punctuation">.</span>avg_degree<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询所有<strong>任课教师</strong>的tname和depart。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> tname<span class="token punctuation">,</span> depart
<span class="token keyword">FROM</span> courses <span class="token keyword">AS</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> teachers <span class="token keyword">AS</span> t
<span class="token keyword">ON</span> c<span class="token punctuation">.</span>tno <span class="token operator">=</span> t<span class="token punctuation">.</span>tno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> tname<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> tname<span class="token punctuation">,</span> depart
<span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> tno <span class="token operator">IN</span><span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> tno
	<span class="token keyword">FROM</span> courses<span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> tname<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★查询所有<strong>未讲课</strong>的教师的Tname和Depart。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tname<span class="token punctuation">,</span> depart
<span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> tno <span class="token operator">NOT</span> <span class="token operator">IN</span><span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> tno
	<span class="token keyword">FROM</span> courses<span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> tname<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★查询<strong>至少有2名</strong>男生的班号。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> class
<span class="token keyword">FROM</span> students
<span class="token keyword">WHERE</span> ssex <span class="token operator">=</span> <span class="token string">'男'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> class
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★查询students表中**不姓“王”**的同学记录。</p>
<p>解答：</p>
<ul>
<li>LIKE操作符</li>
<li>通配符%</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> students
<span class="token keyword">WHERE</span> sname <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">'王%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★查询students表中每个学生的姓名和<strong>年龄</strong>。</p>
<p>解答：</p>
<ul>
<li>当前<strong>日期</strong>函数CURDATE()</li>
<li>当前<strong>日期和时间</strong>函数NOW()</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sname<span class="token punctuation">,</span> TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">,</span> sbirthday<span class="token punctuation">,</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> age
<span class="token keyword">FROM</span> students<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>★★查询students表中<strong>最大</strong>和<strong>最小</strong>的sbirthday<strong>日期</strong>值。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token function">MAX</span><span class="token punctuation">(</span>Sbirthday<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> max_birthday<span class="token punctuation">,</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token function">MIN</span><span class="token punctuation">(</span>Sbirthday<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> min_birthday<span class="token punctuation">,</span>
<span class="token keyword">FROM</span> Students<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>以<strong>班号</strong>和<strong>年龄</strong>从大到小的顺序查询students表中的全部记录。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> students
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> class <span class="token keyword">DESC</span><span class="token punctuation">,</span> TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">,</span> sbirthday<span class="token punctuation">,</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询“男”教师及其<strong>所上的课程</strong>。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tname<span class="token punctuation">,</span> cname
<span class="token keyword">FROM</span> teachers <span class="token keyword">AS</span> t <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> courses <span class="token keyword">AS</span> c
<span class="token keyword">ON</span> t<span class="token punctuation">.</span>tno <span class="token operator">=</span> c<span class="token punctuation">.</span>tno
<span class="token keyword">WHERE</span> tsex<span class="token operator">=</span><span class="token string">'男'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> tname<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★查询<strong>最高分</strong>同学的sno、cno和degree列。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sno<span class="token punctuation">,</span> cno<span class="token punctuation">,</span> degree
<span class="token keyword">FROM</span> scores
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cno
<span class="token keyword">HAVING</span> degree<span class="token operator">=</span><span class="token function">MAX</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询和“李军”<strong>同性别</strong>的所有同学的sname。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 方法一 子查询</span>
<span class="token keyword">SELECT</span> sname
<span class="token keyword">FROM</span> students
<span class="token keyword">WHERE</span> ssex <span class="token operator">=</span> <span class="token punctuation">(</span>
			<span class="token keyword">SELECT</span> ssex
			<span class="token keyword">FROM</span> students
			<span class="token keyword">WHERE</span> sname <span class="token operator">=</span> <span class="token string">'李军'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token comment"># 方法二 联结表</span>
<span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span>Sname
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> students <span class="token keyword">AS</span> s2
<span class="token keyword">ON</span> s1<span class="token punctuation">.</span>ssex<span class="token operator">=</span>s2<span class="token punctuation">.</span>ssex
<span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>sname <span class="token operator">=</span> <span class="token string">'李军'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>★★查询和“李军”<strong>同性别</strong>并<strong>同班</strong>的同学sname。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sname
<span class="token keyword">FROM</span> students <span class="token keyword">AS</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> students <span class="token keyword">AS</span> s2
<span class="token keyword">ON</span> s1<span class="token punctuation">.</span>ssex <span class="token operator">=</span> s2<span class="token punctuation">.</span>ssex <span class="token operator">AND</span> s1<span class="token punctuation">.</span>class <span class="token operator">=</span> s2<span class="token punctuation">.</span>class
<span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>sname <span class="token operator">=</span> <span class="token string">'李军'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询所有<strong>选修“计算机导论”课程</strong>的**“男”**同学的成绩表。</p>
<p>解答：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sname<span class="token punctuation">,</span> degree
<span class="token keyword">FROM</span> scores <span class="token keyword">AS</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> courses <span class="token keyword">AS</span> c
<span class="token keyword">ON</span> s1<span class="token punctuation">.</span>cno <span class="token operator">=</span> c<span class="token punctuation">.</span>cno
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> students <span class="token keyword">AS</span> s2
<span class="token keyword">ON</span> s1<span class="token punctuation">.</span>sno <span class="token operator">=</span> s2<span class="token punctuation">.</span>sno
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>cname <span class="token operator">=</span> <span class="token string">'计算机导论'</span> <span class="token operator">AND</span> s2<span class="token punctuation">.</span>ssex <span class="token operator">=</span> <span class="token string">'男'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> degree <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<hr>
<h2 id="练习二"><a href="#练习二" class="headerlink" title="练习二"></a>练习二</h2><h3 id="准备数据-1"><a href="#准备数据-1" class="headerlink" title="准备数据"></a>准备数据</h3><h4 id="建表语句-1"><a href="#建表语句-1" class="headerlink" title="建表语句"></a>建表语句</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> userinfo <span class="token punctuation">(</span>
  userId <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  birth <span class="token keyword">date</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orderinfo <span class="token punctuation">(</span>
  orderId <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  userId <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  isPaid <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  price <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  paidTime <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>orderId<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h4><ul>
<li><p>获取链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/11ZtjKnv5-nwyf6cMyk_3JQ#list/path=%2F">用户消费行为分析数据</a>；提取码：yu63</p>
</li>
<li><p>数据文件</p>
<ul>
<li><code>user_info_utf.csv</code></li>
<li><code>order_info_utf.csv</code></li>
</ul>
</li>
<li><p>通过navicat，选择对应的数据库表，选择<strong>导入</strong>：</p>
<ol>
<li><p>导入类型：CSV File</p>
</li>
<li><ul>
<li>导入从：选择需要导入的数据文件</li>
<li>编码：UTF-8(<strong>默认</strong>)</li>
</ul>
</li>
<li><p>记录分隔符：CRLF(<strong>默认</strong>)</p>
</li>
<li><ul>
<li>字段名行：若数据文件<strong>不包含数据表的列名</strong>，则输入<strong>0</strong>(<strong>默认</strong>为第<strong>1</strong>行)；</li>
<li>第一个数据行：若文件<strong>不包含数据表的列名</strong>，则输入<strong>1</strong>(<strong>默认</strong>为第<strong>2</strong>行)；</li>
<li><strong>日期排序</strong>：注意<strong>年月日的顺序</strong></li>
</ul>
</li>
<li><p>确认目标表</p>
</li>
<li><p>确认对应的<strong>目标字段</strong></p>
</li>
<li><p>将记录<strong>添加</strong>到目标表&#x2F;<strong>删除目标表中原数据</strong>，用导入的记录代替</p>
</li>
<li><p>开始执行</p>
</li>
</ol>
</li>
</ul>
<hr>
<h3 id="练习题-1"><a href="#练习题-1" class="headerlink" title="练习题"></a>练习题</h3><ol>
<li><p>统计不同月份的下单人数</p>
 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span>paidTime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> userId<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> orderinfo
<span class="token keyword">WHERE</span> isPaid <span class="token operator">=</span> <span class="token string">'已支付'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span>paidTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>统计用户<strong>三月份</strong>的<strong>复购</strong>率和<strong>回购</strong>率(三月份购买的用户，<strong>四月份也购买</strong>)</p>
 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 复购率</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span> <span class="token keyword">AS</span> 下单用户数<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span>cnt <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 复购用户数
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> userId<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token keyword">as</span> cnt
      <span class="token keyword">FROM</span> orderinfo
      <span class="token keyword">WHERE</span> isPaid <span class="token operator">=</span> <span class="token string">'已支付'</span> <span class="token operator">AND</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span>paidTime<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> userId<span class="token punctuation">)</span> <span class="token keyword">AS</span> t<span class="token punctuation">;</span>
      
<span class="token comment"># 3月份的回购率</span>
<span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>m<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>m<span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> userId<span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span>paidTime<span class="token punctuation">,</span> <span class="token string">'%Y-%m-01'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> m
			<span class="token keyword">FROM</span> orderinfo
			<span class="token keyword">WHERE</span> isPaid <span class="token operator">=</span> <span class="token string">'已支付'</span>
			<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> userId<span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span>paidTime<span class="token punctuation">,</span> <span class="token string">'%Y-%m-01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t1
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> userId<span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span>paidTime<span class="token punctuation">,</span> <span class="token string">'%Y-%m-01'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> m
			<span class="token keyword">FROM</span> orderinfo
			<span class="token keyword">WHERE</span> isPaid <span class="token operator">=</span> <span class="token string">'已支付'</span>
			<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> userId<span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span>paidTime<span class="token punctuation">,</span> <span class="token string">'%Y-%m-01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t2
<span class="token keyword">ON</span> t1<span class="token punctuation">.</span>userId <span class="token operator">=</span> t2<span class="token punctuation">.</span>userId <span class="token operator">AND</span> t1<span class="token punctuation">.</span>m <span class="token operator">=</span> DATE_ADD<span class="token punctuation">(</span>t2<span class="token punctuation">.</span>m<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">MONTH</span><span class="token punctuation">)</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>m<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>统计男女用户的<strong>消费频次</strong>(<strong>平均数</strong>)是否有差异</p>
</li>
</ol>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> sex<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> o<span class="token punctuation">.</span>userId<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cnt  <span class="token comment"># count(*)的作用为 统计消费次数</span>
      <span class="token keyword">FROM</span> orderinfo <span class="token keyword">AS</span> o
      <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span>
                  <span class="token keyword">FROM</span> userinfo
                  <span class="token keyword">WHERE</span> sex <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t
      <span class="token keyword">ON</span> o<span class="token punctuation">.</span>userId <span class="token operator">=</span> t<span class="token punctuation">.</span>userId
      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> o<span class="token punctuation">.</span>userId<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">AS</span> t2
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sex<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li><p>统计<strong>多次消费</strong>的用户，第一次和最后一次消费间隔是多少</p>
 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> userId<span class="token punctuation">,</span> DATEDIFF<span class="token punctuation">(</span><span class="token function">MAX</span><span class="token punctuation">(</span>paidTime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>paidTime<span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> orderinfo
<span class="token keyword">WHERE</span> isPaid <span class="token operator">=</span> <span class="token string">'已支付'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> userId
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>统计不同<strong>年龄段</strong>，用户的消费金额是否有差异？</p>
 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> ageGroup<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> o<span class="token punctuation">.</span>userId<span class="token punctuation">,</span> ageGroup<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token keyword">AS</span> cnt
<span class="token keyword">FROM</span> orderinfo <span class="token keyword">AS</span> o
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> userId<span class="token punctuation">,</span> CEIL<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>birth<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> ageGroup
					<span class="token keyword">FROM</span> userinfo
					<span class="token keyword">WHERE</span> birth <span class="token operator">></span> <span class="token string">'1901-00-00'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t
<span class="token keyword">ON</span> o<span class="token punctuation">.</span>userId <span class="token operator">=</span> t<span class="token punctuation">.</span>userId
<span class="token keyword">WHERE</span> isPaid <span class="token operator">=</span> <span class="token string">'已支付'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> o<span class="token punctuation">.</span>userId<span class="token punctuation">,</span> ageGroup<span class="token punctuation">)</span> <span class="token keyword">AS</span> t2
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ageGroup<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>统计消费的<strong>二八法则</strong>，消费的top20%用户，贡献了多少额度</p>
 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> userId<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">AS</span> total
	<span class="token keyword">FROM</span> orderinfo <span class="token keyword">AS</span> o
	<span class="token keyword">WHERE</span> isPaid <span class="token operator">=</span> <span class="token string">'已支付'</span>
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> userId
	<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total <span class="token keyword">DESC</span>
	<span class="token keyword">LIMIT</span> <span class="token number">17000</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<hr>
<h2 id="练习三"><a href="#练习三" class="headerlink" title="练习三"></a>练习三</h2><h3 id="准备数据-2"><a href="#准备数据-2" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> datafrog_test1
<span class="token punctuation">(</span>userid <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
changjing <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
int_time <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> datafrog_test1 
<span class="token keyword">VALUES</span> 	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">1401</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">1402</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1402</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1003</span><span class="token punctuation">,</span><span class="token number">1403</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token number">1404</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1003</span><span class="token punctuation">,</span><span class="token number">1400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token number">1402</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1003</span><span class="token punctuation">,</span><span class="token number">1403</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1403</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">1404</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">1402</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">1403</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1404</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1003</span><span class="token punctuation">,</span><span class="token number">1405</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>求用户id对应的<strong>前两个不同场景</strong>。(场景重复的话，选场景的第一个访问时间，场景不足两个也输出其场景)</p>
<hr>
<h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><hr>
<h2 id="Leetcode-上的SQL题"><a href="#Leetcode-上的SQL题" class="headerlink" title="Leetcode 上的SQL题"></a>Leetcode 上的SQL题</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/second-highest-salary/">176. 第二高的薪水</a></p>
</li>
<li><p><code>LIMIT/OFFSET</code></p>
</li>
<li><p><code>IFNULL()/ISNULL()</code>函数</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/nth-highest-salary/submissions/">177. 第N高的薪水</a></p>
</li>
<li><p><code>CREATE FUNCTION</code></p>
<ul>
<li><code>LIMIT/OFFSET</code>之后<strong>不能包含运算表达式</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/department-top-three-salaries/submissions/">185. 部门工资前三高的所有员工 </a></p>
<ul>
<li><strong>窗口函数</strong>——<code>DENSE_RANK()</code>：<strong>有并列名次的行，不占用下一名次的位置</strong></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rank-scores/submissions/">178. 分数排名</a></p>
<ul>
<li><strong>窗口函数</strong>——<code>DENSE_RANK()</code></li>
<li>MySQL如果<strong>要 将保留字转义 用作列名</strong>，可以<strong>在关键字之前和之后使用撇号</strong>。例如**`Rank`**</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/consecutive-numbers/solution/sql-server-jie-fa-by-neilsons/">SQL SERVER 解法 - 连续出现的数字 - 力扣（LeetCode）</a></p>
</li>
<li><p>※<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/consecutive-numbers/">180. 连续出现的数字</a></p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Num <span class="token keyword">AS</span> ConsecutiveNums
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> Num<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_cnt 
      <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> num<span class="token punctuation">,</span> 
            <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id<span class="token punctuation">)</span> <span class="token operator">-</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> num 
                                                               <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> orde
           <span class="token keyword">FROM</span> logs<span class="token punctuation">)</span> <span class="token keyword">AS</span> W
     <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> num<span class="token punctuation">,</span> orde<span class="token punctuation">)</span> <span class="token keyword">AS</span> S
<span class="token keyword">WHERE</span> num_cnt <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/employees-earning-more-than-their-managers/">181. 超过经理收入的员工</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customers-who-never-order/submissions/">183. 从不订购的客户</a></p>
<ul>
<li><strong>空值的筛选</strong>为<code>IS NULL</code>&#x2F;<code>IS NOT NULL</code>，不是<code>= NULL</code></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/department-highest-salary/submissions/">184. 部门工资最高的员工</a></p>
<ul>
<li><strong>每个组内比较</strong>，使用<strong>子查询</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/delete-duplicate-emails/">196. 删除重复的电子邮箱 </a></p>
<ul>
<li>子查询</li>
<li>EXISTS 和 IN的运用(<strong>EXISTS 更高效</strong>)</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rising-temperature/">197. 上升的温度</a></p>
<ul>
<li>时间处理函数<code>DATE_ADD()</code></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/trips-and-users/submissions/">262. 行程和用户</a></p>
<ul>
<li><code>BETWEEN ... AND ...</code></li>
<li>IF表达式</li>
<li>ROUND函数<strong>舍入小数</strong></li>
<li><code>COUNT</code>函数&#x2F;<code>AVG</code>函数</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/big-countries/">595. 大的国家</a></p>
<ul>
<li>UNION和OR的选择</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/swap-salary/">627. 交换工资</a></p>
<ul>
<li><code>CASE... WHEN</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="牛客网上的SQL题"><a href="#牛客网上的SQL题" class="headerlink" title="牛客网上的SQL题"></a>牛客网上的SQL题</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/c1472daba75d4635b7f8540b837cc719?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">获取当前薪水第二多的员工的emp_no以及其对应的薪水salary</a></p>
</li>
<li><p>不让使用ORDER BY排序时，<strong>利用子查询</strong>和<code>MAX()</code></p>
</li>
<li><p>⭐<a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/fc7344ece7294b9e98401826b94c6ea5?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">查找所有员工自入职以来的薪水涨幅情况</a></p>
<ul>
<li>嵌套查询</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/b9068bfe5df74276bd015b9729eec4bf?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">对所有员工的薪水按照salary进行按照1-N的排名</a></p>
<ul>
<li>窗口函数</li>
<li><strong>排序细节</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/8fe212a6c71b42de9c15c56ce354bebe?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">获取所有非manager员工当前的薪水情况</a></p>
<ul>
<li>使用INNER JOIN而不是LEFT JOIN</li>
<li>一个部门里可能有多个manager，所以用<code>NOT IN</code>比用<code>!=</code>更合理</li>
</ul>
</li>
<li><p>⭐<a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f858d74a030e48da8e0f69e21be63bef?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">获取员工其当前的薪水比其manager当前薪水还高的相关信息</a></p>
<ul>
<li><strong>创建两张表（一张记录当前所有员工的工资，另一张只记录部门经理的工资）进行比较</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/eb9b13e5257744db8265aa73de04fd44?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">给出每个员工每年薪水涨幅超过5000的员工编号emp_no</a></p>
<ul>
<li>题意模糊：应该为<strong>给出薪水与去年相比丈夫超过5000的员工编号</strong></li>
<li>使用INNER JOIN而不是LEFT JOIN</li>
<li><strong>时间线的判断方法很有参考价值</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/3a303a39cc40489b99a7e1867e6507c5?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">查找描述信息中包含robot的电影对应的分类名称以及电影数目，而且还需要该分类对应电影数量&gt;&#x3D;5部</a></p>
<ul>
<li><strong>筛选方法</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/ac233de508ef4849b0eeb4f38dcf09cf?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">创建一个actor表，包含如下列信息</a></p>
<ul>
<li>创建表的时候，有些地方必须<strong>加括号</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/153c8a8e7805400ba8e384e03acc6b3e?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">批量插入数据，不使用replace操作</a></p>
<ul>
<li>MySQL插入数据，如果数据已存在则忽略的语句是<code>INSERT IGNORE table_name VALUES(...);</code></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/e1824daa0c49404aa602cf0cb34bdd75?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">对first_name创建唯一索引uniq_idx_firstname</a></p>
<ul>
<li><strong>创建索引</strong></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/b9db784b5e3d488cbd30bd78fdb2a862?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">针对actor表创建视图actor_name_view</a></p>
<ul>
<li>创建视图</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f9fa9dc1a1fc4130b08e26c22c7a1e5f?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">针对上面的salaries表emp_no字段创建索引idx_emp_no</a></p>
<ul>
<li>强制索引(MySQL 为 <strong>FORCE INDEX</strong>)</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/7e920bb2e1e74c4e83750f5c16033e2e?tpId=82&tags=&title=&diffculty=0&judgeStatu=0&rp=1">构造一个触发器audit_log</a></p>
<ul>
<li><strong>此触发器必须按照AFTER INSERT执行，因为在BEFORE INSERT语句执行之前，新的行数据还没有生成</strong>。<ul>
<li>通常，<strong>将BEFORE用于数据验证和净化</strong></li>
</ul>
</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/3d92551a6f6d4f1ebde272d20872cf05?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">删除emp_no重复的记录，只保留最小的id对应的记录</a></p>
<ul>
<li><pre><code class="language-SQL">  DELETE FROM table_name 
  WHERE xxx
  <pre class="line-numbers language-none"><code class="language-none">
- [将所有to_date为9999-01-01的全部更新为NULL](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;859f28f43496404886a77600ea68ef59?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

	- &#96;&#96;&#96;sql
		UPDATE table_name
		SET xxx
		WHERE xxx;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre>
</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/2bec4d94f525458ca3d0ebf3bc8cd240?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">将id&#x3D;5以及emp_no&#x3D;10001的行数据替换成id&#x3D;5以及emp_no&#x3D;10005</a></p>
<ul>
<li><code>REPLACE(s, s1, s2)</code>函数</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/5277d7f92aa746ab8aa42886e5d570d4?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">将titles_test表名修改为titles_2017</a></p>
<ul>
<li>修改表名的两种方式<ul>
<li><code>RENAME TABLE table_name1 TO table_name2;</code></li>
<li><code>ALTER TABLE table_name1 RENAME TO table_name2;</code></li>
</ul>
</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/aeaa116185f24f209ca4fa40e226de48?tpId=82&tags=&title=&diffculty=0&judgeStatus=0&rp=1">在audit表上创建外键约束，其emp_no对应employees_test表的主键id</a></p>
<ul>
<li><pre><code class="language-sql">  ALTER TABLE table_name
  ADD [CONSTRAINT fk_name] -- CONSTRAINT fk_name 定义外键名，可不定义
  FOREIGN KEY (xx) REFERENCES another_table (xx);
  <pre class="line-numbers language-none"><code class="language-none">
- [将所有获取奖金的员工当前的薪水增加10%](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;d3b058dcc94147e09352eb76f93b3274?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

	- MySQL不支持&#96;*&#x3D;&#96;这样的简化字符使用

- [使用含有关键字exists查找未分配具体部门的员工的所有信息](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;c39cbfbd111a4d92b221acec1c7c1484?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;&amp;rp&#x3D;1)

	- EXISTS和IN的选择
	- EXISTS的用法

- [获取有奖金的员工相关信息](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;5cdbf1dcbe8d4c689020b6b2743820bf?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

	- CASE语句

- [统计salary的累计和running_total](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;58824cd644ea47d7b2b670c506a159a6?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

	- 窗口函数

- [对于employees表中，给出奇数行的first_name](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;e3cf1171f6cc426bac85fd4ffa786594?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

	- 窗口函数

- [刷题通过的题目排名](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;cd2e10a588dc4c1db0407d0bf63394f3?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

	- 窗口函数
	- 排序

- [异常的邮件概率](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;d6dd656483b545159d3aa89b4c26004e?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)
	
	- COUNT函数非NULL的都会计数
	
- [牛客每个人最近的登录日期(三)](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;16d41af206cd4066a06a3a0aa585ad3d?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)
	- 在执行乘法&#96;*&#96;前，**注意括号的使用**
	- &#96;WHERE XX IN XXX&#96;**可以用于对一个组合的查询**
	
- ⭐[牛客每个人最近的登录日期(四)](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;e524dc7450234395aa21c75303a42b0a?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)
	- 解法一：LEFT JOIN + IFNULL函数
		- 笛卡尔积**如果WHERE不满足，整个所生成的元组就不会显示**，**如果要显示的话,就必须使用JOIN连接**
	- 解法二：窗口函数 + SUM函数
	
- ⭐⭐[牛客每个人最近的登录日期(五)](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;ea0c56cd700344b590182aad03cc61b8?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

- ⭐[牛客每个人最近的登录日期(六)](https:&#x2F;&#x2F;www.nowcoder.com&#x2F;practice&#x2F;572a027e52804c058e1f8b0c5e8a65b4?tpId&#x3D;82&amp;tags&#x3D;&amp;title&#x3D;&amp;diffculty&#x3D;0&amp;judgeStatus&#x3D;0&amp;rp&#x3D;1)

---

## 最近登陆时间，增量更新：

table_1是一个按天分区的 用户日志表，每次一个用户登陆都会新加一行：

day           timestamp             uid

2018-08-01     2018-08-01 11:00:00    1

2018-08-01     2018-08-01 14:00:00    1

 

需要根据table_1新建一个table_2:

Day           uid        latest_login_time

2018-08-01    1          2018-08-01 14:00:00 

 

每天新增一个昨日的分区的全量用户表，其中latest_login_time是自用户登录起最近一次登录的时间

&#96;&#96;&#96;sql
CREATE TABLE tabel2 (
    day	DATE NOT NULL,
    uid	INT NOT NULL,
    &#96;latest login time&#96; TIMESTAMP
);

INSERT INTO table2(day,
                  uid,
                  &#96;latest login time&#96;)
SELECT day, uid, MAX(&#96;timestamp&#96;)
FROM table_1
WHERE DATEDIFF(CURDATE(), day) &#x3D; 1 -- 昨天
GROUP BY uid;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="累计用户数计算"><a href="#累计用户数计算" class="headerlink" title="累计用户数计算"></a>累计用户数计算</h2><p>table a是一个用户<strong>注册时间</strong>的记录表,一个用户只有一条数据，a表如下：</p>
<p>create_time  					uid </p>
<p>2018-08-01 14:07:09 	111</p>
<p>2018-08-02 14:07:09 	134</p>
<p>需要计算<strong>8月份累计注册用户数</strong>(从8月1日开始累计计算，8月1日为8月1日注册用户数，8月2日为8月1日-2日两天的注册用户数），计算结果格式如下：</p>
<p>时间 累计用户数</p>
<p>2018-08-01 	2000000</p>
<p>2018-08-02 	2100000</p>
<p>…………….</p>
<p>2018-08-31 10000000</p>
<pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">SELECT DATE(create_time) AS 时间, 
		COUNT(uid) OVER (ORDER BY creat_time) AS 累计用户数
FROM &#96;table a&#96;
WHERE YEAR(create_time) &#x3D; 2018 AND MONTH(create_time) &#x3D; 8;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="连续访问天数"><a href="#连续访问天数" class="headerlink" title="连续访问天数"></a>连续访问天数</h2><p>table a 是一个用户登陆时间记录表，每登陆一次会记录一条记录，a表如下：</p>
<p>log_time 							uid</p>
<p>2018-07-01 12:00:00 	123</p>
<p>2018-07-01 13:00:00 	123</p>
<p>2018-07-02 14:08:09 	456</p>
<p>需要计算出7月1日登陆的用户，在后续连续登陆7天，14天，30天的人数</p>
<p>计算结果格式如下：</p>
<p>7月1日登陆总用户数 连续登陆7天用户数 连续登陆14天用户数 。。。。</p>
<p>1000 500 200</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>table_a<span class="token punctuation">.</span>uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'7月1日登录总用户数'</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>table_b<span class="token punctuation">.</span>uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'连续登录7天的用户数'</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>table_c<span class="token punctuation">.</span>uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'连续登录14天的用户数'</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> uid
			<span class="token keyword">FROM</span> consecutive_task
			<span class="token keyword">WHERE</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>login_time<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'2018-07-01'</span><span class="token punctuation">)</span> table_a
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> <span class="token punctuation">(</span>login_date <span class="token operator">-</span> rank_num<span class="token punctuation">)</span> <span class="token keyword">AS</span> rnk
           <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> login_date<span class="token punctuation">,</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> uid
                                                             <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> login_date<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rank_num
                 <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>login_time<span class="token punctuation">)</span> <span class="token keyword">AS</span> login_date
                       <span class="token keyword">FROM</span> consecutive_task
                       <span class="token keyword">WHERE</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>login_time<span class="token punctuation">)</span> <span class="token operator">BETWEEN</span> <span class="token string">'2018-07-01'</span> <span class="token operator">AND</span> <span class="token string">'2018-07-07'</span>
                       <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> login_date<span class="token punctuation">)</span> b1 <span class="token punctuation">)</span> b2
           <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> rnk
           <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>rnk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">)</span> table_b									
<span class="token keyword">ON</span> table_a<span class="token punctuation">.</span>uid <span class="token operator">=</span> table_b<span class="token punctuation">.</span>uid
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> <span class="token punctuation">(</span>login_date <span class="token operator">-</span> rank_num<span class="token punctuation">)</span> <span class="token keyword">AS</span> rnk
           <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> login_date<span class="token punctuation">,</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> uid
                                                             <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> login_date<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rank_num
                 <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>login_time<span class="token punctuation">)</span> <span class="token keyword">AS</span> login_date
                       <span class="token keyword">FROM</span> consecutive_task
                       <span class="token keyword">WHERE</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>login_time<span class="token punctuation">)</span> <span class="token operator">BETWEEN</span> <span class="token string">'2018-07-01'</span> <span class="token operator">AND</span> <span class="token string">'2020-07-14'</span>
                       <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> login_date<span class="token punctuation">)</span> c1 <span class="token punctuation">)</span> c2
           <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> rnk
           <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>rnk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">)</span> table_c									
<span class="token keyword">ON</span> table_a<span class="token punctuation">.</span>uid <span class="token operator">=</span> table_c<span class="token punctuation">.</span>uid<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="新增用户的近7日留存率"><a href="#新增用户的近7日留存率" class="headerlink" title="新增用户的近7日留存率"></a>新增用户的近7日留存率</h2><p>table1：用户新增表，一个设备首次激活都新加一行：</p>
<p>timestamp，device 【新增的日期，新增的设备】</p>
<p>table2: 是一个<strong>按天分区</strong>的用户活跃表，每次一个用户登陆都会新加一行：</p>
<p>day，device 【活跃的日期，活跃的设备】</p>
<p>需要计算用户新增用户的留存数，留存率【1-7日】</p>
<p>计算结果格式如下：</p>
<p>新增日期 	新增设备数 	次日留存数 	次日留存率 	2日留存数 	2日留存率 ….</p>
<p>timestamp 	1000 				500 					50% 				450 				45%</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token keyword">first</span> <span class="token keyword">AS</span> 新增日期<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> a<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token keyword">AS</span> 新增设备数<span class="token punctuation">,</span> 
			<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">first</span> <span class="token operator">-</span> b<span class="token punctuation">.</span><span class="token keyword">day</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>device<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 次日留存数<span class="token punctuation">,</span> 
            	CONCAT<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">first</span> <span class="token operator">-</span> b<span class="token punctuation">.</span><span class="token keyword">day</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>device<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> a<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 次日留存率 
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>device<span class="token punctuation">,</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token keyword">timestamp</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">first</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token keyword">day</span> 
      <span class="token keyword">FROM</span> table1 a <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> table2 b 
      <span class="token keyword">ON</span> a<span class="token punctuation">.</span>device <span class="token operator">=</span> b<span class="token punctuation">.</span>device<span class="token punctuation">)</span> c
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> a<span class="token punctuation">.</span><span class="token keyword">first</span><span class="token punctuation">;</span> <span class="token comment">-- 按 新增用户的日期 分组</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="计算日活用户签到，开宝箱，阅读行为的用户各自占比"><a href="#计算日活用户签到，开宝箱，阅读行为的用户各自占比" class="headerlink" title="计算日活用户签到，开宝箱，阅读行为的用户各自占比"></a>计算日活用户签到，开宝箱，阅读行为的用户各自占比</h2><p>table1: 是一个按天分区的<strong>用户活跃表</strong>，每次一个用户<strong>登陆</strong>都会新加一行：</p>
<p>day，uid 【活跃的日期，活跃的用户id】 </p>
<p>table2：是一个按天分区的<strong>用户行为表</strong>，每一种<strong>行为</strong>都会新加一行：</p>
<p>day ,uid,type 【日期，用户id，type类型：1表示签到，2表示开宝箱，3表示阅读】 </p>
<p>需要计算，<strong>签到占日活的比例</strong>，开宝箱占日活的比例，阅读占日活的比例</p>
<p>计算结果格式如下：</p>
<p>日期		活跃用户数		签到占日活的比例		开宝箱占日活的比例		阅读占日活的比例</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">day</span> <span class="token keyword">AS</span> 日期<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> 活跃用户数<span class="token punctuation">,</span> 
			<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> 签到占日活的比例<span class="token punctuation">,</span>
			<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> 开宝箱占日活的比例<span class="token punctuation">,</span>
			<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> 阅读占日活的比例
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token keyword">type</span> 
      <span class="token keyword">FROM</span> table_1 <span class="token keyword">AS</span> a <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> table_2 <span class="token keyword">AS</span> b 
      <span class="token keyword">ON</span> a<span class="token punctuation">.</span>uid <span class="token operator">=</span> b<span class="token punctuation">.</span>uid <span class="token operator">AND</span> a<span class="token punctuation">.</span><span class="token keyword">day</span> <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token keyword">day</span><span class="token punctuation">)</span> c
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">day</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="练习四"><a href="#练习四" class="headerlink" title="练习四"></a>练习四</h2><h3 id="准备数据-3"><a href="#准备数据-3" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employee 
<span class="token punctuation">(</span>
	id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	salary <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	departmentid <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Employee 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Joe"</span><span class="token punctuation">,</span><span class="token number">70000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Henry"</span><span class="token punctuation">,</span><span class="token number">80000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Sam"</span><span class="token punctuation">,</span><span class="token number">60000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">"Max"</span><span class="token punctuation">,</span><span class="token number">90000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Department 
<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Department 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"IT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Sales"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="练习题-2"><a href="#练习题-2" class="headerlink" title="练习题"></a>练习题</h3><p>找出每个部门工资最高的员工</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> d<span class="token punctuation">.</span>name Department<span class="token punctuation">,</span> e<span class="token punctuation">.</span>name Employee<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>Salary<span class="token punctuation">)</span> Salary
<span class="token keyword">FROM</span> Employee e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Department d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>departmentid <span class="token operator">=</span> d<span class="token punctuation">.</span>id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> d<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="准备数据-4"><a href="#准备数据-4" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customer
<span class="token punctuation">(</span>
    Id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	Email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customer
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a@b.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'c@d.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'a@b.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="练习题-3"><a href="#练习题-3" class="headerlink" title="练习题"></a>练习题</h3><p>查找 customer 表中所有重复的电子邮箱</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Email
<span class="token keyword">FROM</span> customer
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Email
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>Email<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="准备数据-5"><a href="#准备数据-5" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Customers
<span class="token punctuation">(</span> 
    Id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Customers 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Joe'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Henry'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Sam'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Max'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders
<span class="token punctuation">(</span>
	Id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	CustomerId <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Orders
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>练习题：找出所有<strong>从不订购任何东西</strong>的客户</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 方法一</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">AS</span> customers
<span class="token keyword">FROM</span> customers c <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> orders o
<span class="token keyword">ON</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> o<span class="token punctuation">.</span>customerId
<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment">-- 方法二</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">AS</span> customers
<span class="token keyword">FROM</span> customers
<span class="token keyword">WHERE</span> id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> customerid
								<span class="token keyword">FROM</span> orders<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="准备数据-6"><a href="#准备数据-6" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Scores
<span class="token punctuation">(</span> 
    id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    score <span class="token keyword">FLOAT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> scores 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3.65</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3.85</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3.65</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>练习题：通过查询实现分数排名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 窗口函数 ROW_NUMBER()</span>
<span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> score <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Rank<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> scores
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> score <span class="token keyword">DESC</span><span class="token punctuation">;</span>

<span class="token comment">-- ROW_NUMBER() 对应 使用变量 的做法</span>
<span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> <span class="token variable">@curRank</span><span class="token operator">=</span><span class="token variable">@curRank</span><span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Rank<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> scores<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@RANK</span>:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> r
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> score <span class="token keyword">DESC</span><span class="token punctuation">;</span>

<span class="token comment">-- RANK() (有并列名次的行，会占用下一名次的位置)对应使用变量的做法</span>
<span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>rank<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> <span class="token variable">@curRank</span> <span class="token operator">=</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token variable">@preScore</span> <span class="token operator">=</span> score<span class="token punctuation">,</span> <span class="token variable">@curRank</span><span class="token punctuation">,</span> <span class="token variable">@incRank</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>rank<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token comment">-- 同分同排名，不同分下一排名</span>
                <span class="token variable">@incRank</span>:<span class="token operator">=</span><span class="token variable">@incRank</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">-- 作用等同于 ROW_NUMBER()</span>
                <span class="token variable">@preScore</span>:<span class="token operator">=</span>score
      <span class="token keyword">FROM</span> scores<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@curRank</span>:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@preScore</span>:<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token variable">@incRank</span>:<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> r
      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> score <span class="token keyword">DESC</span><span class="token punctuation">)</span> s<span class="token punctuation">;</span>
      
<span class="token comment">-- DENSE_RANK() 对应使用变量的做法</span>

<span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>rank<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> <span class="token variable">@curRank</span><span class="token operator">=</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token variable">@preScore</span><span class="token operator">=</span>score<span class="token punctuation">,</span> <span class="token variable">@curRank</span><span class="token punctuation">,</span> <span class="token variable">@curRank</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>rank<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
				<span class="token variable">@preScore</span><span class="token operator">=</span>score
	  <span class="token keyword">FROM</span> scores<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@curRank</span>:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@preScore</span>:<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">)</span> r
	  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> socre <span class="token keyword">DESC</span><span class="token punctuation">)</span> s<span class="token punctuation">;</span>
	  
<span class="token comment">-- 使用CASE WHEN更简洁</span>
<span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> <span class="token keyword">CASE</span> 
				<span class="token keyword">WHEN</span> score<span class="token operator">=</span><span class="token variable">@preScore</span> <span class="token keyword">THEN</span> <span class="token variable">@curRank</span>
                <span class="token keyword">WHEN</span> <span class="token variable">@preScore</span>:<span class="token operator">=</span>score <span class="token keyword">THEN</span> <span class="token variable">@curRank</span>:<span class="token operator">=</span><span class="token variable">@curRank</span><span class="token operator">+</span><span class="token number">1</span> <span class="token comment">-- @preScore:=score 赋值语句必为true</span>
              <span class="token keyword">END</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>rank<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> scores<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@curRank</span>:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@preScore</span>:<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">)</span> r
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> score <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="准备数据-7"><a href="#准备数据-7" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> seat 
<span class="token punctuation">(</span> 
    id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	student <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> seat 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Abbot'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Doris'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Emerson'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Green'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'Jeames'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>练习题：座位id 是连续递增的，改变相邻俩学生的座位。<br> <strong>要求:</strong></p>
<ul>
<li><strong>如果学生人数是奇数，则不需要改变最后一个同学的座位。</strong></li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">(</span><span class="token keyword">CASE</span>
            <span class="token keyword">WHEN</span> id <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> id <span class="token operator">!=</span> cnt <span class="token keyword">THEN</span> id<span class="token operator">+</span><span class="token number">1</span> <span class="token comment">-- 奇数且不是最后一个</span>
            <span class="token keyword">WHEN</span> id <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> id <span class="token operator">=</span> cnt <span class="token keyword">THEN</span> id
            <span class="token keyword">ELSE</span> id <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">-- 偶数</span>
        <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> id<span class="token punctuation">,</span> student
<span class="token keyword">FROM</span> seat<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cnt <span class="token comment">-- 用于判断当前是否是最后一个学生(奇数的特殊判断)</span>
            <span class="token keyword">FROM</span> seat<span class="token punctuation">)</span> t
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="准备数据-8"><a href="#准备数据-8" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> Employee<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employee
<span class="token punctuation">(</span> 
		Id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		Name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		Salary <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		ManagerId <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Employee 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Joe'</span><span class="token punctuation">,</span> <span class="token number">70000</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Henry'</span><span class="token punctuation">,</span> <span class="token number">80000</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Sam'</span><span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Max'</span><span class="token punctuation">,</span> <span class="token number">90000</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>练习题：编写一个 SQL 查询，获取收入超过他们经理的员工的姓名。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> e1<span class="token punctuation">.</span>Name
<span class="token keyword">FROM</span> Employee e1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Employee e2
<span class="token keyword">ON</span> e1<span class="token punctuation">.</span>ManagerId <span class="token operator">=</span> e2<span class="token punctuation">.</span>Id
<span class="token keyword">WHERE</span> e1<span class="token punctuation">.</span>Salary <span class="token operator">></span> e2<span class="token punctuation">.</span>Salary<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="练习五"><a href="#练习五" class="headerlink" title="练习五"></a>练习五</h2><p><strong>题目:<strong>X 市建了一个新的体育馆，每日人流量信息被记录在这三列信息中：序号 (id)、日期 (visit_date)、 人流量 (people)。<br> 请编写一个查询语句，找出</strong>人流量的高峰期</strong>。<br> <strong>要求:</strong></p>
<ul>
<li>高峰期时，<strong>至少连续三行</strong>记录中的<strong>人流量不少于100</strong></li>
<li><strong>每天只有一行记录</strong>，日期随着 id 的增加而增加</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stadium 
<span class="token punctuation">(</span> 
    id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
	visit_date <span class="token keyword">DATE</span><span class="token punctuation">,</span> 
	people <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> stadium 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'2017-01-01'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'2017-01-02'</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'2017-01-03'</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'2017-01-04'</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'2017-01-05'</span><span class="token punctuation">,</span><span class="token number">145</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">'2017-01-06'</span><span class="token punctuation">,</span><span class="token number">1455</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'2017-01-07'</span><span class="token punctuation">,</span><span class="token number">199</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'2017-01-08'</span><span class="token punctuation">,</span><span class="token number">188</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 方法一：朴实的自联结</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> stadium t1<span class="token punctuation">,</span> stadium t2<span class="token punctuation">,</span> stadium t3
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>people <span class="token operator">>=</span> <span class="token number">100</span>     <span class="token comment">-- 筛选表中 人流量>=100 的行</span>
		<span class="token operator">AND</span> t2<span class="token punctuation">.</span>people <span class="token operator">>=</span> <span class="token number">100</span>
		<span class="token operator">AND</span> t3<span class="token punctuation">.</span>people <span class="token operator">>=</span> <span class="token number">100</span>
		<span class="token operator">AND</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>id <span class="token operator">-</span> t2<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- 错位联结，从t1的id开始连续3天有人流高峰</span>
				 <span class="token operator">AND</span> t1<span class="token punctuation">.</span>id <span class="token operator">-</span> t3<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">2</span>
			 	 <span class="token operator">AND</span> t2<span class="token punctuation">.</span>id <span class="token operator">-</span> t3<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span>
                <span class="token punctuation">)</span> 
             	<span class="token operator">OR</span> <span class="token punctuation">(</span>t2<span class="token punctuation">.</span>id <span class="token operator">-</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- 补充 t1之后只有1天人流高峰，但之前也有连续高峰 的情况</span>
					 <span class="token operator">AND</span> t2<span class="token punctuation">.</span>id <span class="token operator">-</span> t3<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">2</span>
					 <span class="token operator">AND</span> t1<span class="token punctuation">.</span>id <span class="token operator">-</span> t3<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token operator">OR</span> <span class="token punctuation">(</span>t3<span class="token punctuation">.</span>id <span class="token operator">-</span> t2<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- 补充t1为人流高峰最后一天 的情况</span>
					 <span class="token operator">AND</span> t2<span class="token punctuation">.</span>id <span class="token operator">-</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span>
					 <span class="token operator">AND</span> t3<span class="token punctuation">.</span>id <span class="token operator">-</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> 
             <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>id<span class="token punctuation">;</span> 
       
       
<span class="token comment">-- 方法二：MySQL 8.0 之后开始支持 WITH AS 语句(子查询部分，作用类似于一个视图，但with as 属于一次性的，而且必须和其他sql一起使用才行) WITH子句的查询必须用括号括起来</span>
<span class="token keyword">WITH</span> t1 <span class="token keyword">AS</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> visit_date<span class="token punctuation">,</span> people<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>id <span class="token operator">-</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span> rk
<span class="token keyword">FROM</span> stadium
<span class="token keyword">WHERE</span> people <span class="token operator">>=</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> visit_date<span class="token punctuation">,</span> people
<span class="token keyword">FROM</span> t1
<span class="token keyword">WHERE</span> rk <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> rk 
            <span class="token keyword">FROM</span> t1
            <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> rk
            <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="挑战题"><a href="#挑战题" class="headerlink" title="挑战题"></a>挑战题</h3><p><img src="https://i.loli.net/2020/09/13/2pa43QDgf8wzReU.png"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> 日期<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">)</span> 活跃用户数<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">day</span><span class="token operator">-</span><span class="token keyword">first</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 次日留存用户数<span class="token punctuation">,</span>
			<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">day</span><span class="token operator">-</span><span class="token keyword">first</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> 三日留存用户数<span class="token punctuation">,</span>
			<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">day</span><span class="token operator">-</span><span class="token keyword">first</span><span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> 七日留存用户数<span class="token punctuation">,</span>
			CONCAT<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">day</span><span class="token operator">-</span><span class="token keyword">first</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">)</span> 次日留存率<span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">day</span><span class="token operator">-</span><span class="token keyword">first</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">)</span> 三日留存率<span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">day</span><span class="token operator">-</span><span class="token keyword">first</span><span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> a<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">)</span> 七日留存率
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span>dayno<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">first</span>
      <span class="token keyword">FROM</span> act_user_info
      <span class="token keyword">WHERE</span> app_name <span class="token operator">=</span> <span class="token string">'相机'</span><span class="token punctuation">)</span> a <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span>dayno<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">day</span>
                                           <span class="token keyword">FROM</span> act_user_info
                                           <span class="token keyword">WHERE</span> app_name <span class="token operator">=</span> <span class="token string">'相机'</span><span class="token punctuation">)</span> b
<span class="token keyword">ON</span> a<span class="token punctuation">.</span>uid <span class="token operator">=</span> b<span class="token punctuation">.</span>uid
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">first</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="PDD笔试题"><a href="#PDD笔试题" class="headerlink" title="PDD笔试题"></a>PDD笔试题</h2><h3 id="2-用户行为分析"><a href="#2-用户行为分析" class="headerlink" title="2. 用户行为分析"></a>2. 用户行为分析</h3><p>表1——用户行为表tracking_log，大概字段有（user_id‘用户编号’,opr_id‘操作编号’,log_time‘操作时间’）</p>
<ul>
<li>统计<strong>每天</strong>符合以下条件的<strong>用户数</strong>：<strong>A操作之后是B操作</strong>，AB操作必须相连</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 使用窗口函数</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> user_id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> opr_id<span class="token punctuation">,</span>
     			LEAD<span class="token punctuation">(</span>opr_id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pre_opr
     <span class="token keyword">FROM</span> tracking_log<span class="token punctuation">)</span> table_1
<span class="token keyword">WHERE</span> opr_id<span class="token operator">=</span><span class="token string">'A'</span> <span class="token operator">AND</span> pre_opr<span class="token operator">=</span><span class="token string">'B'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">-- 使用用户变量</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> user_id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">,</span> user_id<span class="token punctuation">,</span>
     			<span class="token punctuation">(</span><span class="token keyword">CASE</span>
     				<span class="token keyword">WHEN</span> <span class="token variable">@pre_opr</span><span class="token operator">=</span><span class="token string">'A'</span> <span class="token operator">AND</span> opr_id<span class="token operator">=</span><span class="token string">'B'</span> <span class="token keyword">THEN</span> <span class="token variable">@isJoin</span>:<span class="token operator">=</span><span class="token boolean">True</span> <span class="token operator">AND</span> <span class="token variable">@pre_opr</span>:<span class="token operator">=</span>opr_id
      				<span class="token keyword">ELSE</span> <span class="token variable">@pre_opr</span>:<span class="token operator">=</span>opr_id
      			<span class="token keyword">END</span><span class="token punctuation">)</span> isJoin
      <span class="token keyword">FROM</span> tracking_log<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@pre_opr</span>:<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token variable">@isJoin</span>:<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span> a<span class="token punctuation">)</span> table_1
<span class="token keyword">WHERE</span> isJoin<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-用户新增留存分析"><a href="#3-用户新增留存分析" class="headerlink" title="3. 用户新增留存分析"></a>3. 用户新增留存分析</h3><p>表1——用户登陆表user_log，大概字段有（user_id‘用户编号’，log_time‘登陆时间’）</p>
<ul>
<li>获取每日新增用户数，以及第2天、第30天的回访比例</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> 新增用户数<span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">,</span> 注册日期<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> u1<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 第<span class="token number">2</span>天回访比例<span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">,</span> 注册日期<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">,</span> u1<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 第<span class="token number">30</span>天回访比例
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> user_id<span class="token punctuation">,</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token function">MIN</span><span class="token punctuation">(</span>log_time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 注册日期
      <span class="token keyword">FROM</span> user_log
      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> user_id<span class="token punctuation">)</span> u1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> user_log u2
<span class="token keyword">ON</span> u1<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u2<span class="token punctuation">.</span>user_id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 注册日期<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-贝叶斯公式的应用"><a href="#4-贝叶斯公式的应用" class="headerlink" title="4. 贝叶斯公式的应用"></a>4. 贝叶斯公式的应用</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80835787">数据分析笔试题(1) - 知乎</a></p>
<hr>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Partition_date<span class="token punctuation">,</span> 
		<span class="token punctuation">(</span><span class="token keyword">CASE</span>
			<span class="token keyword">WHEN</span> DATEDIFF<span class="token punctuation">(</span>t2<span class="token punctuation">.</span>Partition_date<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>Partition_date<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span> 
		<span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'流失1天'</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token keyword">CASE</span>
        	<span class="token keyword">WHEN</span> DATEDIFF<span class="token punctuation">(</span>t2<span class="token punctuation">.</span>Partition_date<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>Partition_date<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span> 
        <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'流失2天'</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token keyword">CASE</span>
        	<span class="token keyword">WHEN</span> DATEDIFF<span class="token punctuation">(</span>t2<span class="token punctuation">.</span>Partition_date<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>Partition_date<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span> 
        <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'流失3天'</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token keyword">CASE</span>
        	<span class="token keyword">WHEN</span> DATEDIFF<span class="token punctuation">(</span>t2<span class="token punctuation">.</span>Partition_date<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>Partition_date<span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">30</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span> 
        <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'流失30天以上'</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> user_id<span class="token punctuation">,</span> Partition_date
      <span class="token keyword">FROM</span> user_active
      <span class="token keyword">WHERE</span> daily_active_status_map<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> t1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> user_id<span class="token punctuation">,</span> Partition_date
                                                     <span class="token keyword">FROM</span> usre_active
                                                     <span class="token keyword">WHERE</span> daily_active_status_map<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> t2
<span class="token keyword">ON</span> t1<span class="token punctuation">.</span>user_id<span class="token operator">=</span>t2<span class="token punctuation">.</span>user_id
<span class="token keyword">WHERE</span> t2<span class="token punctuation">.</span>user_id <span class="token operator">IS</span> <span class="token boolean">NULL</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Partition_date
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Partition_date <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a>
              <a href="/tags/SQL/" rel="tag"><i class="fa fa-tag"></i> SQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/06/16/MySQL%E6%8A%A5%E9%94%99%E7%9A%84%E5%88%86%E7%B1%BB%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" rel="prev" title="MySQL报错的分类与解决方法">
                  <i class="fa fa-angle-left"></i> MySQL报错的分类与解决方法
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/06/17/Navicat%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" rel="next" title="Navicat使用技巧">
                  Navicat使用技巧 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hunter</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Hunter1023/Hunter1023.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
